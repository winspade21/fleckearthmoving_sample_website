;/*FB_PKG_DELIM*/

__d("LSInsertMessage",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.i64.eq(e[2],t.i64.cast([0,20]))?t.db.table(12).add({threadKey:e[3],timestampMs:e[5],messageId:e[8],offlineThreadingId:e[9],authorityLevel:e[2],primarySortKey:e[6],senderId:e[10],isAdminMessage:e[12],sendStatus:e[15],sendStatusV2:e[16],text:e[0],subscriptErrorMessage:e[1],secondarySortKey:e[7],stickerId:e[11],messageRenderingType:e[13],isUnsent:e[17],unsentTimestampMs:e[18],mentionOffsets:e[19],mentionLengths:e[20],mentionIds:e[21],mentionTypes:e[22],replySourceId:e[23],replySourceType:e[24],replySourceTypeV2:e[25],replyStatus:e[26],replySnippet:e[27],replyMessageText:e[28],replyToUserId:e[29],replyMediaExpirationTimestampMs:e[30],replyMediaUrl:e[31],replyMediaPreviewWidth:e[33],replyMediaPreviewHeight:e[34],replyMediaUrlMimeType:e[35],replyMediaUrlFallback:e[36],replyCtaId:e[37],replyCtaTitle:e[38],replyAttachmentType:e[39],replyAttachmentId:e[40],replyAttachmentExtra:e[41],replyType:e[42],isForwarded:e[43],forwardScore:e[44],hasQuickReplies:e[45],adminMsgCtaId:e[46],adminMsgCtaTitle:e[47],adminMsgCtaType:e[48],cannotUnsendReason:e[49],textHasLinks:e[50],viewFlags:e[51],displayedContentTypes:e[52],viewedPluginKey:e[53],viewedPluginContext:e[54],quickReplyType:e[55],hotEmojiSize:e[56],platformXmdEncoded:e[57],sendAttributionXmd:e[58],replySourceTimestampMs:e[59],ephemeralDurationInSec:e[60],msUntilExpirationTs:e[61],ephemeralExpirationTs:e[62],takedownState:e[63],isCollapsed:e[64],subthreadKey:e[65],botResponseId:e[66],metadataDataclass:e[67],editCount:e[68],isPaidPartnership:e[69],adminSignatureName:e[70],adminSignatureProfileUrl:e[71],adminSignatureCreatorType:e[72],replyMessageHiddenState:e[73],translatedText:e[74],textDialect:e[75],translatedTextDialect:e[76],scheduledTimestamp:e[77],isVideoQuickSend:e[78],subthreadParentMessageId:e[79],isExclusiveToSubthread:e[80]}):t.sequence([function(r){return t.db.table(12).fetch([[[e[9]]],"optimistic"]).next().then(function(t,r){var o,a,i=t.done,l=t.value;return i?(o=[e[6],e[7],void 0],n[0]=o[0],n[1]=o[1],n[2]=o[2],o):(r=l.item,a=[r.primarySortKey,r.secondarySortKey,r.localDataId],n[0]=a[0],n[1]=a[1],n[2]=a[2])})},function(n){return t.forEach(t.filter(t.db.table(12).fetch([[[e[9]]],"optimistic"]),function(n){return n.offlineThreadingId===e[9]&&t.i64.lt(n.authorityLevel,e[2])}),function(e){return e.delete()})},function(r){return t.db.table(12).add({threadKey:e[3],timestampMs:e[5],messageId:e[8],offlineThreadingId:e[9],authorityLevel:e[2],primarySortKey:n[0],senderId:e[10],isAdminMessage:e[12],sendStatus:e[15],sendStatusV2:e[16],text:e[0],subscriptErrorMessage:e[1],secondarySortKey:n[1],stickerId:e[11],messageRenderingType:e[13],isUnsent:e[17],unsentTimestampMs:e[18],mentionOffsets:e[19],mentionLengths:e[20],mentionIds:e[21],mentionTypes:e[22],replySourceId:e[23],replySourceType:e[24],replySourceTypeV2:e[25],replyStatus:e[26],replySnippet:e[27],replyMessageText:e[28],replyToUserId:e[29],replyMediaExpirationTimestampMs:e[30],replyMediaUrl:e[31],replyMediaPreviewWidth:e[33],replyMediaPreviewHeight:e[34],replyMediaUrlMimeType:e[35],replyMediaUrlFallback:e[36],replyCtaId:e[37],replyCtaTitle:e[38],replyAttachmentType:e[39],replyAttachmentId:e[40],replyAttachmentExtra:e[41],replyType:e[42],isForwarded:e[43],forwardScore:e[44],hasQuickReplies:e[45],adminMsgCtaId:e[46],adminMsgCtaTitle:e[47],adminMsgCtaType:e[48],cannotUnsendReason:e[49],textHasLinks:e[50],viewFlags:e[51],displayedContentTypes:e[52],viewedPluginKey:e[53],viewedPluginContext:e[54],quickReplyType:e[55],hotEmojiSize:e[56],platformXmdEncoded:e[57],sendAttributionXmd:e[58],replySourceTimestampMs:e[59],ephemeralDurationInSec:e[60],msUntilExpirationTs:e[61],ephemeralExpirationTs:e[62],takedownState:e[63],isCollapsed:e[64],subthreadKey:e[65],botResponseId:e[66],metadataDataclass:e[67],editCount:e[68],isPaidPartnership:e[69],adminSignatureName:e[70],adminSignatureProfileUrl:e[71],adminSignatureCreatorType:e[72],replyMessageHiddenState:e[73],translatedText:e[74],textDialect:e[75],translatedTextDialect:e[76],scheduledTimestamp:e[77],isVideoQuickSend:e[78],subthreadParentMessageId:e[79],isExclusiveToSubthread:e[80],localDataId:n[2]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxInsertMessageStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSMoveThreadToInboxAndUpdateParent",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(t){var n=t.update,r=t.item;return n({folderName:"inbox",parentThreadKey:e[1]})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxMoveThreadToInboxAndUpdateParentStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSUpdateParticipantLastMessageSendTimestamp",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.resolve(r)}e.__sproc_name__="LSMailboxUpdateParticipantLastMessageSendTimestampStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSUpdateTypingIndicator",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(r){return t.i64.neq(e[3],void 0)?n[0]=e[3]:n[0]=t.i64.cast([0,5e3]),e[2]?(n[1]=t.i64.of_float(Date.now()),t.db.table(52).put({threadKey:e[0],senderId:e[1],expirationTimestampMs:t.i64.add(n[1],n[0])})):t.resolve()},function(n){return e[2]?t.resolve():t.forEach(t.filter(t.db.table(52).fetch([[[e[0],e[1]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.senderId,e[1])}),function(e){return e.delete()})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSTypingUpdateTypingIndicatorStoredProcedure",e.__tables__=["typing_indicator"],a.exports=e}),null);