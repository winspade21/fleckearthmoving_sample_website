;/*FB_PKG_DELIM*/

__d("LSGetParentThreadKey",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[0]=t.i64.cast([0,0]):(r=a.item,n[0]=r.parentThreadKey)})},function(e){return r[0]=n[0]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxGetParentThreadKeyStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSUpdateFolderThreadSnippet",["LSArrayGetObjectAt","LSGetThreadParticipantDisplayName","LSGetViewerFBID","LSLocalize"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?0:(a=l.item,t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([-1,4294967284])),t.sequence([function(o){return t.i64.eq(a.threadType,t.i64.cast([0,17]))?t.sequence([function(n){return t.i64.eq(e[0],t.i64.cast([-1,4294967284])),t.sequence([function(n){return t.i64.neq(e[1],void 0)?t.resolve(r[4]=e[1]):t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.lt(n.lastReadWatermarkTimestampMs,n.lastActivityTimestampMs)&&(t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))||t.i64.eq(n.authorityLevel,t.i64.cast([0,60]))&&t.i64.eq(n.syncSource,t.i64.cast([0,2])))})).then(function(e){return r[5]=e})},function(e){return r[4]=r[5]}])},function(e){return r[2]=r[4]}])},function(o){return t.sequence([function(o){return t.i64.eq(r[2],t.i64.cast([0,0]))?t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&[t.i64.cast([0,18]),t.i64.cast([0,19]),t.i64.cast([0,27]),t.i64.cast([0,28])].some(function(e){return t.i64.eq(n.threadType,e)})})).then(function(e){return r[5]=e})},function(e){return t.i64.eq(r[5],t.i64.cast([0,1]))?t.sequence([function(e){return n("LSLocalize").localizeV2Async(t.i64.cast([0,1416259530]),void 0).then(function(e){return r[7]=e})},function(e){return r[6]=r[7]}]):t.sequence([function(e){return r[7]=t.createArray(),r[9]=(r[7].push(t.i64.to_string(r[5])),r[7]),n("LSLocalize").localizeV2Async(t.i64.cast([0,1681736754]),r[7]).then(function(e){return r[8]=e})},function(e){return r[6]=r[8]}])},function(e){return r[4]=r[6]}]):t.sequence([function(e){return t.i64.eq(r[2],t.i64.cast([0,1]))?t.sequence([function(e){return n("LSLocalize").localizeV2Async(t.i64.cast([0,3802288555]),void 0).then(function(e){return r[6]=e})},function(e){return t.resolve(r[7]=r[6])},function(e){return r[5]=r[7]}]):t.sequence([function(e){return r[6]=t.createArray(),r[8]=(r[6].push(t.i64.to_string(r[2])),r[6]),n("LSLocalize").localizeV2Async(t.i64.cast([0,1420387436]),r[6]).then(function(e){return r[7]=e})},function(e){return r[5]=r[7]}])},function(e){return r[4]=r[5]}])},function(e){return r[3]=r[4]}])},function(e){return r[1]=r[3]}]):t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([-1,4294967265]))?t.sequence([function(n){return t.db.table(9).fetchDesc([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[3]=void 0:(t=o.item,r[3]=t.threadName)})},function(e){return r[2]=r[3]}]):t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([-1,4294967268]))?t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))})).then(function(e){return r[4]=e})},function(e){return t.i64.eq(r[4],t.i64.cast([0,0]))?t.resolve(r[5]=""):t.sequence([function(e){return r[6]=t.createArray(),r[8]=(r[6].push(r[4]),r[6]),n("LSLocalize").localizeV2Async(t.i64.cast([0,612154886]),r[6]).then(function(e){return r[7]=e})},function(e){return r[5]=r[7]}])},function(e){return r[3]=r[5]}]):t.sequence([function(n){return t.i64.eq(e[0],t.i64.cast([-1,4294967284])),t.sequence([function(n){return t.i64.neq(e[1],void 0)?t.resolve(r[9]=e[1]):t.sequence([function(n){return t.count(t.filter(t.db.table(9).fetch([[[e[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(n){return t.i64.eq(n.parentThreadKey,e[0])&&t.i64.lt(n.lastReadWatermarkTimestampMs,n.lastActivityTimestampMs)&&(t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))||t.i64.eq(n.authorityLevel,t.i64.cast([0,60]))&&t.i64.eq(n.syncSource,t.i64.cast([0,2])))})).then(function(e){return r[10]=e})},function(e){return r[9]=r[10]}])},function(e){return r[4]=r[9]}])},function(n){return r[5]=e[2].get("all_read"),r[6]=e[2].get("unread_singular"),r[7]=e[2].get("unread_plural"),t.i64.eq(r[4],t.i64.cast([0,0]))?r[8]=r[5]:(t.i64.eq(r[4],t.i64.cast([0,1]))?r[9]=[t.i64.to_string(r[4]),r[6]].join(""):r[9]=[t.i64.to_string(r[4]),r[7]].join(""),r[8]=r[9]),r[3]=r[8]}])},function(e){return r[2]=r[3]}])},function(e){return r[1]=r[2]}])},function(e){return r[0]=r[1]}])},function(e){return t.forEach(t.db.table(9).fetch([[[a.threadKey]]]),function(e){var t=e.update,n=e.item;return t({snippet:r[0],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0})})}]))})},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateFolderThreadSnippetStoredProcedure",e.__tables__=["threads","participants","messages","attachments"],a.exports=e}),null);
__d("LSUpdateParentFolderReadWatermark",["LSArrayGetObjectAt","LSGetParentThreadKey","LSUpdateFolderThreadSnippet"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return t.storedProcedure(n("LSGetParentThreadKey"),e[0]).then(function(e){var t;return t=e,r[0]=t[0],t})},function(o){return t.i64.neq(r[0],t.i64.cast([0,0]))?t.sequence([function(e){return t.i64.eq(r[0],t.i64.cast([-1,4294967284])),t.sequence([function(e){return t.sortBy(t.filter(t.db.table(9).fetch([[[r[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(e){return t.i64.eq(e.parentThreadKey,r[0])&&t.i64.lt(e.lastReadWatermarkTimestampMs,e.lastActivityTimestampMs)}),[["lastReadWatermarkTimestampMs","ASC"]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[2]=void 0:(t=o.item,r[2]=t.lastReadWatermarkTimestampMs)})},function(e){return r[1]=r[2]}])},function(e){return t.i64.neq(r[1],void 0)?t.forEach(t.db.table(9).fetch([[[r[0]]]]),function(e){var t=e.update,n=e.item;return t({lastReadWatermarkTimestampMs:r[1]})}):t.sequence([function(e){return t.db.table(9).fetch([[[r[0]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[2]=void 0:(t=o.item,r[2]=t.lastActivityTimestampMs)})},function(e){return t.i64.neq(r[2],void 0)?t.forEach(t.db.table(9).fetch([[[r[0]]]]),function(e){var t=e.update,n=e.item;return t({lastReadWatermarkTimestampMs:r[2]})}):t.resolve()}])},function(o){return t.storedProcedure(n("LSUpdateFolderThreadSnippet"),r[0],void 0,e[1])}]):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateParentFolderReadWatermarkStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);