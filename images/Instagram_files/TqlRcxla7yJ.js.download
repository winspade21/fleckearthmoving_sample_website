;/*FB_PKG_DELIM*/

__d("CPXComposerConstants",[],(function(t,n,r,o,a,i){"use strict";var e=120,l=68,s=90,u=160,c=10,d=4;i.THUMBNAIL_WIDTH=e,i.THUMBNAIL_HEIGHT=l,i.REEL_THUMBNAIL_WIDTH=s,i.REEL_THUMBNAIL_HEIGHT=u,i.NUM_OF_THUMBNAILS=c,i.MAX_NUM_THUMBNAILS=d}),66);
__d("CanvasToBlobImpl",["BlobFactory"],(function(t,n,r,o,a,i){function e(e,t){for(var r=atob(e.substr(e.indexOf(",")+1)),o=new Uint8Array(r.length),a=0;a<r.length;a++)o[a]=r.charCodeAt(a);return n("BlobFactory").getBlob([o],{type:t})}a.exports={getBlob:e}}),null);
__d("VideoThumbnail_UNTYPED",[],(function(t,n,r,o,a,i){var e=(function(){"use strict";function e(e){this.$1=e}var t=e.prototype;return t.getURL=function(){return this.$1},e})();a.exports=e}),null);
__d("dataURLToBlob",["BlobFactory","CanvasToBlobImpl","CanvasToBlobResource","Promise","WebWorker"],(function(t,n,r,o,a,i,l){var e,s=t.URL||t.webkitURL||{};function u(t,a){return!s.createObjectURL||!r("BlobFactory").isSupported?(e||(e=n("Promise"))).reject("Browser doesn't support this feature"):r("WebWorker").isSupported()?new(e||(e=n("Promise")))(function(e,n){var o=new(r("WebWorker"))(r("CanvasToBlobResource")).setMessageHandler(function(t){e(t),o.terminate()}).setErrorHandler(function(e){n(e.message),o.terminate()}).execute().postMessage({dataURL:t,fileType:a})}):(e||(e=n("Promise"))).resolve(o("CanvasToBlobImpl").getBlob(t,a))}l.default=u}),98);
__d("canvasToBlob",["Promise","dataURLToBlob","promiseDone"],(function(t,n,r,o,a,i,l){var e;function s(t,o,a){return new(e||(e=n("Promise")))(function(e,n){if("toBlob"in t)t.toBlob(e,o,a);else{var i=t.toDataURL(o,a);r("promiseDone")(r("dataURLToBlob")(i,o).then(function(t){e(t)},n))}})}l.default=s}),98);
__d("CanvasVideoThumbnail",["EventListener","Promise","VideoThumbnail_UNTYPED","canvasToBlob","promiseDone"],(function(t,n,r,o,a,i,l){var e,s=(function(t){function o(e,n,r,o,a,i,l){var s;return o===void 0&&(o=null),a===void 0&&(a=null),i===void 0&&(i=0),l===void 0&&(l=0),s=t.call(this,null)||this,s.$CanvasVideoThumbnail$p_1=e,s.$CanvasVideoThumbnail$p_2=n,s.$CanvasVideoThumbnail$p_3=r,s.$CanvasVideoThumbnail$p_4=o,s.$CanvasVideoThumbnail$p_5=a,s.$CanvasVideoThumbnail$p_6=i,s.$CanvasVideoThumbnail$p_7=l,s.$CanvasVideoThumbnail$p_8=s.$CanvasVideoThumbnail$p_1.toDataURL("image/jpeg"),s}babelHelpers.inheritsLoose(o,t);var a=o.prototype;return a.getCanvas=function(){return this.$CanvasVideoThumbnail$p_1},a.getTime=function(){return this.$CanvasVideoThumbnail$p_3?this.$CanvasVideoThumbnail$p_3:0},a.getURL=function(){return this.$CanvasVideoThumbnail$p_8||(this.$CanvasVideoThumbnail$p_8=this.$CanvasVideoThumbnail$p_1.toDataURL("image/jpeg")),this.$CanvasVideoThumbnail$p_8},a.getData=function(){var t=this,o=document.createElement("canvas"),a=o.getContext("2d"),i=this.$CanvasVideoThumbnail$p_2;return new(e||(e=n("Promise")))(function(e,n){var l=r("EventListener").listen(i,"seeked",function(){l.remove(),t.$CanvasVideoThumbnail$p_9(o,a),r("promiseDone")(r("canvasToBlob")(o,"image/jpeg").then(e,n))});i.currentTime=t.$CanvasVideoThumbnail$p_3})},a.getDataWithText=function(o,a,i,l,s,u,c,d){var t=this,m=document.createElement("canvas"),p=m.getContext("2d"),_=this.$CanvasVideoThumbnail$p_2;return new(e||(e=n("Promise")))(function(e,n){var f=r("EventListener").listen(_,"seeked",function(){f.remove(),p.fillStyle=c,p.textAlign=d,t.$CanvasVideoThumbnail$p_9(m,p),p=r("VideoThumbnail_UNTYPED").addTextToCanvasContext(p,o,a,i,l,s,u,c,d),r("promiseDone")(r("canvasToBlob")(m,"image/jpeg").then(e,n))});_.currentTime=t.$CanvasVideoThumbnail$p_3})},a.$CanvasVideoThumbnail$p_9=function(t,n){var e=this.$CanvasVideoThumbnail$p_2;this.$CanvasVideoThumbnail$p_4||this.$CanvasVideoThumbnail$p_5?(t.width=this.$CanvasVideoThumbnail$p_4?this.$CanvasVideoThumbnail$p_4:e.videoWidth,t.height=this.$CanvasVideoThumbnail$p_5?this.$CanvasVideoThumbnail$p_5:e.videoHeight,this.$CanvasVideoThumbnail$p_10(t,n)):(t.width=e.videoWidth,t.height=e.videoHeight,n.drawImage(e,0,0,t.width,t.height))},a.$CanvasVideoThumbnail$p_10=function(t,n){var e=this.$CanvasVideoThumbnail$p_2,r=this.$CanvasVideoThumbnail$p_6,o=this.$CanvasVideoThumbnail$p_7,a=this.$CanvasVideoThumbnail$p_4?this.$CanvasVideoThumbnail$p_4:t.width,i=this.$CanvasVideoThumbnail$p_5?this.$CanvasVideoThumbnail$p_5:t.height;n.drawImage(e,r,o,a,i,0,0,t.width,t.height)},o})(r("VideoThumbnail_UNTYPED"));l.default=s}),98);
__d("HTMLMediaElementReadyStates",[],(function(t,n,r,o,a,i){var e={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},l=e;i.default=l}),66);
__d("IGDComposerEmojiPicker.react",["IGDSBox.react","IGDSPopover.react","JSResourceForInteraction","WebUXLoggingSurfaceContextProvider","lazyLoadComponent","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("lazyLoadComponent")(r("JSResourceForInteraction")("IGDSEmojiTray.react").__setRef("IGDComposerEmojiPicker.react"));function c(e){var t=o("react-compiler-runtime").c(7),n=e.closeAfterSelect,a=e.onClose,i=e.onSelect,l=e.showPopoverArrow,c;t[0]!==n||t[1]!==a||t[2]!==i?(c=s.jsx(r("IGDSBox.react"),{width:340,children:s.jsx(o("WebUXLoggingSurfaceContextProvider").WebUXSurfaceLoggingContext.Provider,{value:"thread_chat_emoji_picker_sheet",children:s.jsx(u,{onClick:function(t,r){i(t),(n===!0||(r==null?void 0:r.type)==="keydown")&&a()},width:"auto"})})}),t[0]=n,t[1]=a,t[2]=i,t[3]=c):c=t[3];var d=c,m;return t[4]!==d||t[5]!==l?(m=s.jsx(r("IGDSPopover.react"),{align:"end",popoverContent:d,popoverName:"emojiTray",position:"above",withArrow:l}),t[4]=d,t[5]=l,t[6]=m):m=t[6],m}l.default=c}),98);
__d("useIGDBroadcastChannelImpressionLoggerWithCheck",["MWCMThreadTypes.react","promiseDone","react","react-compiler-runtime","useIGDBroadcastChannelLogger","useSinglePartialViewImpression"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useCallback;function u(e,t,n){var a=o("react-compiler-runtime").c(6),i=r("useIGDBroadcastChannelLogger")(e),l;a[0]!==i||a[1]!==n||a[2]!==t?(l=function(){t!=null&&o("MWCMThreadTypes.react").isIGBroadcastChannelThread(t)&&r("promiseDone")(i(n))},a[0]=i,a[1]=n,a[2]=t,a[3]=l):l=a[3];var s=l,u;return a[4]!==s?(u={onImpressionStart:s},a[4]=s,a[5]=u):u=a[5],r("useSinglePartialViewImpression")(u)}l.default=u}),98);
__d("IGDSEditPanoOutline24Icon.react",["IGDSSVGIconBase.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(4),n,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("path",{d:"M6.172 22H2v-4.172L17.291 2.536a1.831 1.831 0 0 1 2.59 0l1.583 1.583a1.831 1.831 0 0 1 0 2.59Z",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}),a=s.jsx("line",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",x1:"15.018",x2:"19.191",y1:"4.809",y2:"8.982"}),t[0]=n,t[1]=a):(n=t[0],a=t[1]);var i;return t[2]!==e?(i=s.jsxs(r("IGDSSVGIconBase.react"),babelHelpers.extends({},e,{viewBox:"0 0 24 24",children:[n,a]})),t[2]=e,t[3]=i):i=t[3],i}var c=s.memo(u);l.default=c}),98);
__d("useIGDTriggerEditAction.react",["MAWEditMessageContext.react","MWPReplyContext.react","MessengerWebUXLogger","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.useCallback,c=s.useContext;function d(e,t,n){var a=o("react-compiler-runtime").c(10),i=r("MessengerWebUXLogger").useInteractionLogger(),l=c(o("MAWEditMessageContext.react").Context),s=l.setEditMessageData,u=c(o("MWPReplyContext.react").MWPReplyContext),d=u.clearReply,m=u.reply,p;return a[0]!==d||a[1]!==i||a[2]!==e.messageId||a[3]!==e.threadKey||a[4]!==e.timestampMs||a[5]!==n||a[6]!==m||a[7]!==s||a[8]!==t?(p=function(){m!=null&&d(e.threadKey,!0),s({messageId:e.messageId,threadKey:e.threadKey,threadType:t,timestampMs:e.timestampMs}),i==null||i({eventName:"edit_message_tap"}),n==null||n()},a[0]=d,a[1]=i,a[2]=e.messageId,a[3]=e.threadKey,a[4]=e.timestampMs,a[5]=n,a[6]=m,a[7]=s,a[8]=t,a[9]=p):p=a[9],p}l.default=d}),98);
__d("useMWIsContactRestricted",["LSContactBitOffset"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e!=null&&o("LSContactBitOffset").has(66,e);return t}l.default=e}),98);
__d("useMWPCanUserEditMessage",["I64","LSAuthorityLevel","LSContactBitOffset","LSContactTypeExact","LSHotEmojiSize","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWThreadCutover","MWMessageDeliveryStatus","MWPActor.react","ReQL","ReQLSuspense","URLMatcher","getIsMessageTimeBelowEditThreshold","gkx","isDeliveryStatusErrorState","isMWBumpMessage","isStringNullOrEmpty","mwCMIsAnyCMThread","mwCMIsCMSubthread","useMWGetOtherUserContact","useMWIsContactRestricted","useReStore","useServerTime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=5;function d(t,n,a){var l,d,p,_,f=o("MWPActor.react").useActor(),g=(u||(u=r("useReStore")))(),h=o("ReQLSuspense").useFirst(function(){return o("ReQL").fromTableAscending(g.tables.attachments).getKeyRange(t.threadKey,t.messageId)},[g,t.messageId,t.threadKey],i.id+":68"),y=r("useMWGetOtherUserContact")(t.threadKey,n.threadType,["contactTypeExact"].concat(o("LSContactBitOffset").contactCapabilityFields)),C=y!=null&&(e||(e=o("I64"))).equal(y.contactTypeExact,(s||(s=o("LSIntEnum"))).ofNumber(r("LSContactTypeExact").MESSENGER_KID)),b=r("useMWIsContactRestricted")(y),v=o("MAWThreadCutover").useIsCutoverOpenThread(a),S=r("useServerTime")();if(r("isDeliveryStatusErrorState")(o("MWMessageDeliveryStatus").getFromSendStatus(t.sendStatusV2))||n==null)return!1;var R=(e||(e=o("I64"))).to_int32((l=t.editCount)!=null?l:(e||(e=o("I64"))).zero)<c,L=o("getIsMessageTimeBelowEditThreshold").getIsMessageTimeBelowEditThreshold(e.of_float(S.getTime()),t.timestampMs),E=e.equal(t.senderId,f),k=(d=t.isForwarded)!=null?d:!1,I=t.text!=null&&t.text!=="",T=t.text!=null&&r("URLMatcher").match(t.text)!=null,D=e.equal((p=t.hotEmojiSize)!=null?p:(e||(e=o("I64"))).zero,(s||(s=o("LSIntEnum"))).ofNumber(r("LSHotEmojiSize").NONE)),x=((_=h==null?void 0:h.hasXma)!=null?_:!1)||!r("isStringNullOrEmpty")(t.mentionIds),$=t.isUnsent===!1&&(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE)),P=r("isMWBumpMessage")(t.replyType);return R&&L&&E&&I&&!T&&D&&!k&&!v&&!x&&$&&!b&&!P&&!C&&m(n)}function m(e){var t=e.threadType;return o("LSMessagingThreadTypeUtil").isWorkThread(e.threadSubtype)?!1:o("LSMessagingThreadTypeUtil").isArmadilloSecure(t)||o("LSMessagingThreadTypeUtil").isJoinedDiscoverablePublicBroadcastChannel(t)?!0:r("mwCMIsAnyCMThread")(t)||r("mwCMIsCMSubthread")(t)?o("LSThreadBitOffset").has(194,e)&&r("gkx")("7675"):!!o("LSMessagingThreadTypeUtil").isOpenFnFThread(e)}l.default=d}),98);
__d("useIGDEditMessageMenuItem.react",["fbt","I64","IGDMessageContextMenuItem.react","IGDSEditPanoOutline24Icon.react","MWPActor.react","react","react-compiler-runtime","useIGDTriggerEditAction.react","useMWPCanUserEditMessage"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=e||(e=o("react"));function d(e,t,n){var a=o("react-compiler-runtime").c(4),i=o("MWPActor.react").useActor(),l=e.senderId,d=(u||(u=o("I64"))).equal(l,i),m=r("useIGDTriggerEditAction.react")(e,n.threadType,t),p=r("useMWPCanUserEditMessage")(e,n);if(!d||!p)return null;var _;a[0]===Symbol.for("react.memo_cache_sentinel")?(_=s._(/*BTDS*/"Edit"),a[0]=_):_=a[0];var f=_,g;a[1]===Symbol.for("react.memo_cache_sentinel")?(g=c.jsx(r("IGDSEditPanoOutline24Icon.react"),{alt:f,size:18}),a[1]=g):g=a[1];var h;return a[2]!==m?(h=c.jsx(r("IGDMessageContextMenuItem.react"),{icon:g,label:f,onClick:function(){m()},testid:void 0}),a[2]=m,a[3]=h):h=a[3],h}l.default=d}),226);
__d("IGDSCircleCheckOutlineIcon.react",["IGDSCircleCheckPanoOutlineIcon.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(2),n;return t[0]!==e?(n=s.jsx(r("IGDSCircleCheckPanoOutlineIcon.react"),babelHelpers.extends({},e)),t[0]=e,t[1]=n):n=t[1],n}var c=s.memo(u);l.default=c}),98);
__d("IGDSCopyPanoOutline24Icon.react",["IGDSSVGIconBase.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(3),n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("path",{d:"m20.12 4.707-2.826-2.828A3.026 3.026 0 0 0 15.17 1h-5.167A3.007 3.007 0 0 0 7 4.004V5h-.996A3.007 3.007 0 0 0 3 8.004v11.992A3.007 3.007 0 0 0 6.004 23h7.992A3.007 3.007 0 0 0 17 19.996V19h.996A3.007 3.007 0 0 0 21 15.996V6.83a2.98 2.98 0 0 0-.88-2.123ZM18.586 6 16 6.001V3.414L18.586 6ZM15 19.996C15 20.55 14.55 21 13.996 21H6.004C5.45 21 5 20.55 5 19.996V8.004C5 7.45 5.45 7 6.004 7H7v8.996A3.007 3.007 0 0 0 10.004 19H15v.996ZM17.996 17h-7.992C9.45 17 9 16.55 9 15.996V4.004C9 3.45 9.45 3 10.004 3H14v3.001A2 2 0 0 0 15.999 8H19v7.996C19 16.55 18.55 17 17.996 17Z"}),t[0]=n):n=t[0];var a;return t[1]!==e?(a=s.jsx(r("IGDSSVGIconBase.react"),babelHelpers.extends({},e,{viewBox:"0 0 24 24",children:n})),t[1]=e,t[2]=a):a=t[2],a}var c=s.memo(u);l.default=c}),98);
__d("useIGDMessageCopyMenuItem.react",["fbt","Clipboard","I64","IGDMessageContextMenuItem.react","IGDSBox.react","IGDSCircleCheckOutlineIcon.react","IGDSCopyPanoOutline24Icon.react","IGDThreadListNewMessageLoggingDataContext","Int64Hooks","LSIntEnum","LSMessageReplySourceTypeV2","MWPActor.react","MessengerWebUXLogger","PolarisUA","promiseDone","react","react-compiler-runtime","requireDeferred","useIGDSToaster","usePolarisShowToast","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m=d||(d=o("react")),p=r("requireDeferred")("MWLogMessageAction").__setRef("useIGDMessageCopyMenuItem.react");function _(t,n,a,i){var l=o("react-compiler-runtime").c(27),d=(e||(e=r("useReStore")))(),_=o("MWPActor.react").useActor(),f=r("MessengerWebUXLogger").useInteractionLogger(),g=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),h=t.displayedContentTypes,y=t.replySourceTypeV2!=null&&(u||(u=o("LSIntEnum"))).toNumber(t.replySourceTypeV2)===r("LSMessageReplySourceTypeV2").FORWARD,C=(c||(c=o("I64"))).equal(h,(u||(u=o("LSIntEnum"))).ofNumber(1))||(c||(c=o("I64"))).equal(h,(u||(u=o("LSIntEnum"))).ofNumber(1033)),b=!i&&(C||y&&!!t.text),v=r("useIGDSToaster")(),S=r("usePolarisShowToast")(),R;l[0]!==_||l[1]!==d||l[2]!==g||l[3]!==f||l[4]!==t.messageId||l[5]!==t.senderId||l[6]!==t.text||l[7]!==t.threadKey||l[8]!==n||l[9]!==S||l[10]!==v?(R=function(){var e;f==null||f({eventName:"message_copy",extraData:{},flowInstanceId:g}),o("Clipboard").copy((e=t.text)!=null?e:""),n();var a=s._(/*BTDS*/"Copied"),i=m.jsx(r("IGDSCircleCheckOutlineIcon.react"),{alt:s._(/*BTDS*/"Checkmark icon"),color:"web-always-white"});o("PolarisUA").isMobile()?v.add({icon:i,message:a}):S({text:m.jsxs(r("IGDSBox.react"),{alignItems:"center",columnGap:2,direction:"row",children:[i,a]})}),p.onReady(function(e){return r("promiseDone")(e.log(d,t.messageId,t.threadKey,"message_dot_menu","copy",void 0,void 0,void 0,t.senderId,void 0,_))})},l[0]=_,l[1]=d,l[2]=g,l[3]=f,l[4]=t.messageId,l[5]=t.senderId,l[6]=t.text,l[7]=t.threadKey,l[8]=n,l[9]=S,l[10]=v,l[11]=R):R=l[11];var L;l[12]!==_||l[13]!==d||l[14]!==g||l[15]!==f||l[16]!==t.messageId||l[17]!==t.senderId||l[18]!==t.text||l[19]!==t.threadKey||l[20]!==n||l[21]!==a?(L=[_,d,g,f,t.messageId,t.senderId,t.text,t.threadKey,n,a],l[12]=_,l[13]=d,l[14]=g,l[15]=f,l[16]=t.messageId,l[17]=t.senderId,l[18]=t.text,l[19]=t.threadKey,l[20]=n,l[21]=a,l[22]=L):L=l[22];var E=o("Int64Hooks").useCallbackInt64(R,L);if(!b)return null;var k;l[23]===Symbol.for("react.memo_cache_sentinel")?(k=s._(/*BTDS*/"Copy"),l[23]=k):k=l[23];var I=k,T;l[24]===Symbol.for("react.memo_cache_sentinel")?(T=m.jsx(r("IGDSCopyPanoOutline24Icon.react"),{alt:I,size:18}),l[24]=T):T=l[24];var D;return l[25]!==E?(D=m.jsx(r("IGDMessageContextMenuItem.react"),{icon:T,label:I,onClick:E}),l[25]=E,l[26]=D):D=l[26],D}l.default=_}),226);
__d("MAWDocumentPreProcess",["Promise","WABlobToArrayBuffer","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["MAWDocumentPreProcess"]);function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return c.DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["start document preprocess"]))),(u||(u=n("Promise"))).resolve({file:e,filename:e.name,plaintext:yield o("WABlobToArrayBuffer").blobToArrayBuffer(e),type:"document"})}),m.apply(this,arguments)}function p(r){c.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start optimistic document preprocess"])));var o=t.URL.createObjectURL(r);return(u||(u=n("Promise"))).resolve({file:r,filename:r.name,type:"document",url:o})}l.documentPreprocess=d,l.optimisticDocumentPreprocess=p}),98);
__d("MAWFetchXMADataUtils",["FBLogger","LSXmaContentType","MAWFetchXMABlob","MAWGetImageSpec","MAWParseXMAFBConfig","Promise","WAArmadilloXMA.pb","asyncToGeneratorRuntime","sendToSentQPLLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s={failed_to_fetch_blob_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent",failed_to_fetch_json_for_xma_share:"Failed execute MAWShareAttachment_LinkPreviewQuery for MAWShareAttachent",failed_to_parse_json_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent"};function u(e){var t=Object.entries(r("LSXmaContentType")).find(function(t){var n=t[0],r=t[1];return e===r&&o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[n]!=null}),n=t!=null?o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[t[0]]:void 0;if(n!==void 0)return o("MAWParseXMAFBConfig").isFBSupportedTargetType({fbTargetType:n,silentExposure:!0})?n:(r("FBLogger")("messenger_web_sharing").mustfix("Unsupported XMA Target Type in sending path: "+n),o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE)}function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=t.favicon_blob,i=t.header_image_blob,l=t.overlayIconGlyph,s=t.preview_blob,u=s==null?void 0:new File([s],"preview",{type:s.type}),c=a==null?void 0:new File([a],"favicon",{type:a.type}),d=i==null?void 0:new File([i],"header",{type:i.type});o("sendToSentQPLLogger").markSendToSentPoint(r,"preview_favicon_spec_start");var m=l===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE?(e||(e=n("Promise"))).resolve({height:2,width:2}):u!=null?o("MAWGetImageSpec").getImageSpec_DEPRECATED(u):(e||(e=n("Promise"))).resolve(),p=c!=null?o("MAWGetImageSpec").getImageSpec_DEPRECATED(c):(e||(e=n("Promise"))).resolve(),_=d!=null?o("MAWGetImageSpec").getImageSpec_DEPRECATED(d):(e||(e=n("Promise"))).resolve(),f=yield(e||(e=n("Promise"))).all([m,p,_]),g=f[0],h=f[1],y=f[2];o("sendToSentQPLLogger").markSendToSentPoint(r,"preview_favicon_spec_ready");var C=u==null||g==null?void 0:{file:u,height:g.height,width:g.width},b=c==null||h==null?void 0:{file:c,height:h.height,width:h.width},v=d==null||y==null?void 0:{file:d,height:y.height,width:y.width};return{faviconFileArgs:b,headerImageFileArgs:v,previewFileArgs:C}}),d.apply(this,arguments)}function m(e,t,n,r,o,a){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,u,c){var d=yield(e||(e=n("Promise"))).all([[(t==null?void 0:t.startsWith("ls"))===!0?null:t,"favicon"],[a,"image"],[i,"preview"],[l,"header_image"]].map(function(e){return o("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"MAWFetchXMAData_"+e[1],url:e[0],xmaContentType:c}).then(function(e){return e!=null?e:void 0})})).catch(function(e){return u.forEach(function(e){o("sendToSentQPLLogger").markSendToSentFail(e,"failed_to_fetch_blob_for_xma_share")}),r("FBLogger")("messenger_web_sharing").catching(e).mustfix(s.failed_to_fetch_blob_for_xma_share),[void 0,void 0,void 0,void 0]}),m=d[0],p=d[1],_=d[2],f=d[3];return[m,p,_,f]}),p.apply(this,arguments)}l.XMA_DATA_ERRORS=s,l.convertXmaContentTypeToMessageType=u,l.makeXMAFileArgs=c,l.getPreviewBlobs=m}),98);
__d("MAWFetchXMAData_fetchXmaPreviewDataQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="9840669832713841"}),null);
__d("MAWFetchXMAData_fetchXmaPreviewDataQuery.graphql",["MAWFetchXMAData_fetchXmaPreviewDataQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"url"}],t=[{alias:null,args:[{fields:[{kind:"Variable",name:"url",variableName:"url"}],kind:"ObjectValue",name:"params"}],concreteType:"XFBXMAPreviewData",kind:"LinkedField",name:"xma_preview_data",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_receiver_fetch_supported",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_public",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"post_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"default_cta_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"header_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"subtitle_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"title_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"xma_content_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"favicon_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"header_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"preview_url",storageKey:null},{alias:null,args:null,concreteType:"XFBXMAPreviewDataCtaDataConnection",kind:"LinkedField",name:"cta_data",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBXMACtaData",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cta_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cta_action_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cta_native_url",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"MAWFetchXMAData_fetchXmaPreviewDataQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"MAWFetchXMAData_fetchXmaPreviewDataQuery",selections:t},params:{id:n("MAWFetchXMAData_fetchXmaPreviewDataQuery_facebookRelayOperation"),metadata:{},name:"MAWFetchXMAData_fetchXmaPreviewDataQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("MAWUnshimUrl",["CometLinkShimUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e!=null){var t=o("CometLinkShimUtils").getLinkShimInfo(e,void 0,void 0,void 0,void 0,void 0,!0);return t.shimmed?t.unshimmedHref:e}}l.unshimUrl=e}),98);
__d("MAWFetchXMAData",["fbt","CometRelay","ConstUriUtils","FBLogger","LSXmaContentType","MAWFetchXMADataUtils","MAWFetchXMAData_fetchXmaPreviewDataQuery.graphql","MAWUnshimUrl","MSGDataclassTypes.flow","Promise","WAArmadilloXMA.pb","asyncToGeneratorRuntime","getJSEnumSafe","isFacebookURI","isStringNullOrEmpty","sendToSentQPLLogger"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(e,t){var n;return t.forEach(function(e){o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{xma_data_result:"private"}})}),{defaultCTA:{actionUrl:o("MAWUnshimUrl").unshimUrl(e),buttonType:(n=o("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:o("MAWUnshimUrl").unshimUrl(e),title:s._(/*BTDS*/"_j[\"Private post\",\"599d20d959e0009397c73fb9edb426dd\",1]").toString()},linkType:"internal",overlayIconGlyph:n.EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE,preview_blob:void 0,title_text:s._(/*BTDS*/"Facebook").toString(),transportLayerForLogging:"sender_copy",xma_message_type:n.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE,xmaTargetTypeForLogging:n.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE}}function d(t,r){return o("CometRelay").fetchQuery(t,e!==void 0?e:e=n("MAWFetchXMAData_fetchXmaPreviewDataQuery.graphql"),{url:r}).toPromise()}function m(e,t,n){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a,i,l,s,u,m,p=yield d(e,t).catch(function(e){n.forEach(function(t){o("sendToSentQPLLogger").markSendToSentFail(t,"failed_to_fetch_json_for_xma_share",e)}),r("FBLogger")("messenger_web_sharing").catching(e).mustfix(o("MAWFetchXMADataUtils").XMA_DATA_ERRORS.failed_to_fetch_json_for_xma_share)});n.forEach(function(e){o("sendToSentQPLLogger").markSendToSentPoint(e,"fetch_json_for_xma_share_end")});var _=p==null?void 0:p.xma_preview_data;if(_==null)return n.forEach(function(e){o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{xma_data_result:"empty"}})}),c(t,n);if(_.is_public!==!0)return c(t,n);n.forEach(function(e){o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{xma_data_result:"public"}})});var f={defaultCTA:{actionUrl:o("MAWUnshimUrl").unshimUrl(t),buttonType:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:o("MAWUnshimUrl").unshimUrl(t),title:(a=_.default_cta_title)!=null?a:void 0},linkType:"internal",title_text:(i=(l=_.title_text)!=null?l:_.header_title)!=null?i:void 0},g=r("getJSEnumSafe")(r("LSXmaContentType"),_.xma_content_type),h=o("MAWFetchXMADataUtils").convertXmaContentTypeToMessageType(g),y=_.post_id,C=_.is_receiver_fetch_supported===!0;if(C&&y!=null){var b={__typename:"XMSGMsgrXmaContentRefDataclass",action_type:o("MSGDataclassTypes.flow").XmsgMsgrXmaActionType.Share,content_type:o("MSGDataclassTypes.flow").XmsgMsgrReceiverFetchContentType.Statusupdate,fetch_params:{__typename:"XMSGMsgrReceiverFetchXmaStatusUpdateFetchParams",post_id:y},xma_content_type:r("getJSEnumSafe")(r("LSXmaContentType"),_.xma_content_type),xma_layout_type:o("MSGDataclassTypes.flow").XmsgMsgrReceiverFetchXmaLayoutType.Single};return babelHelpers.extends({},f,{contentRef:JSON.stringify(b),transportLayerForLogging:"receiver_fetch",xma_message_type:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH,xmaTargetTypeForLogging:h})}var v=yield o("MAWFetchXMADataUtils").getPreviewBlobs(_.favicon_url,null,_.preview_url,_.header_image_url,n,g),S=v[0],R=v[1],L=v[2],E=v[3];return babelHelpers.extends({},f,{ctas:(s=_.cta_data)==null||(s=s.nodes)==null?void 0:s.map(function(e){var t,n=o("MAWUnshimUrl").unshimUrl(r("isStringNullOrEmpty")(e.cta_action_url)?void 0:e.cta_action_url),a=o("MAWUnshimUrl").unshimUrl(r("isStringNullOrEmpty")(e.cta_native_url)?void 0:e.cta_native_url);return{actionUrl:n,buttonType:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,ctaType:"xma_web_url",nativeUrl:a,title:(t=e.cta_title)!=null?t:void 0}}),favicon_blob:S!=null?S:void 0,header_image_blob:E!=null?E:void 0,header_title:r("isStringNullOrEmpty")(_.title_text)?void 0:(u=_.header_title)!=null?u:void 0,preview_blob:L!=null?L:void 0,subtitle_text:(m=_.subtitle_text)!=null?m:void 0,transportLayerForLogging:"sender_copy",xma_message_type:h,xmaTargetTypeForLogging:h})}),p.apply(this,arguments)}function _(e,t,a){var i,l=o("ConstUriUtils").getUri(t),s=l==null||(i=l.setSubDomain("www"))==null?void 0:i.toString();if(s==null)return(u||(u=n("Promise"))).resolve({linkType:"unknown",transportLayerForLogging:"sender_copy",xmaTargetTypeForLogging:null});var c=o("MAWUnshimUrl").unshimUrl(t);if(c!=null){var d=o("ConstUriUtils").getUri(c);if(d!=null&&!r("isFacebookURI")(d))return(u||(u=n("Promise"))).resolve({linkType:"external",transportLayerForLogging:"sender_copy",xma_message_type:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE,xmaTargetTypeForLogging:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE})}return a.forEach(function(e){o("sendToSentQPLLogger").markSendToSentPoint(e,"fetch_json_for_xma_share_start")}),m(e,s,a)}l.fetchXMAData=_}),226);
__d("MAWThreadMappingUtils",["FBLogger","LSMessagingThreadTypeUtil","MAWJids","MAWMiActOnActThreadReadyInstrumentation","Promise","ReQL","ReQLSubscribe","asyncToGeneratorRuntime","err","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s=3e4;function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.threads).getKeyRange(t));return n==null?(r("FBLogger")("messenger_web").mustfix("[onActThreadReady] Thread is not ready to be used."),null):o("LSMessagingThreadTypeUtil").isGroup(n.threadType)}),c.apply(this,arguments)}function d(t,a){return(e||(e=n("Promise"))).all([u(t,a),o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.mi_act_mapping_table).getKeyRange(a))]).then(function(e){var t=e[0],n=e[1];return n==null||t==null?(r("FBLogger")("messenger_web").mustfix("[onActThreadReady] Thread is not ready to be used."),null):o("MAWJids").convertIntJidToChatJid(n.jid,t)})}function m(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.mi_act_mapping_table).getKeyRange(t)).then(function(e){return e==null?(r("FBLogger")("messenger_web").mustfix("[onActThreadReady] Thread is not ready to be used."),null):e.jid})}function p(e,t,n){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i){var l,c=null,m=(l=o("MAWMiActOnActThreadReadyInstrumentation")).getOnActThreadReadyInstanceKey(i);l.startQPL(m,i,a,"getChatJidOnceInThreadMappingTable"),l.addPointQPL(m,"get_existing_int_jid_from_mapping_table_start");var p=yield d(t.tables,a);if(l.addPointQPL(m,"get_existing_int_jid_from_mapping_table_end"),p!=null)return o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(m),(e||(e=n("Promise"))).resolve(p);var _=yield u(t.tables,a);if(_==null)throw o("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(m,"thread_not_ready_to_be_used"),r("FBLogger")("messenger_web").mustfixThrow("Thread is not ready to be used.");return o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"subscribe_to_mapping_table_start"),new(e||(e=n("Promise")))(function(e,n){var i=o("ReQL").fromTableDescending(t.tables.mi_act_mapping_table).getKeyRange(a),l=o("ReQLSubscribe").subscribeToFirst(i,function(t){t!=null&&(c!=null&&window.clearTimeout(c),l(),o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"subscribe_to_mapping_table_end"),o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(m),e(o("MAWJids").convertIntJidToChatJid(t.jid,_)))});c=r("setTimeout")(function(){l(),o("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(m,"subscribe_to_mapping_table_timeout"),n(r("err")("Timeout waiting for int jid to be populated in mapping table."))},s)})}),_.apply(this,arguments)}function f(e,t,n){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i){var l,u=null,c=(l=o("MAWMiActOnActThreadReadyInstrumentation")).getOnActThreadReadyInstanceKey(i);l.startQPL(c,i,a,"getIntJidOnceInThreadMappingTable"),l.addPointQPL(c,"get_existing_int_jid_from_mapping_table_start");var d=yield m(t.tables,a);return l.addPointQPL(c,"get_existing_int_jid_from_mapping_table_end"),d!=null?(o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(c),(e||(e=n("Promise"))).resolve(d)):(o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(c,"subscribe_to_mapping_table_start"),new(e||(e=n("Promise")))(function(e,n){var i=o("ReQL").fromTableDescending(t.tables.mi_act_mapping_table).getKeyRange(a),l=o("ReQLSubscribe").subscribeToFirst(i,function(t){t!=null&&(u!=null&&window.clearTimeout(u),l(),o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(c,"subscribe_to_mapping_table_end"),o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(c),e(t.jid))});u=r("setTimeout")(function(){l(),o("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(c,"subscribe_to_mapping_table_timeout"),n(r("err")("Timeout waiting for int jid to be populated in mapping table."))},s)}))}),g.apply(this,arguments)}l.isThreadGroup=u,l.getChatJidFromMappingTable=d,l.getIntJidFromMappingTable=m,l.getChatJidOnceInThreadMappingTable=p,l.getIntJidOnceInThreadMappingTable=f}),98);
__d("MAWGetProtocolMsgIdByMsgIdInUI",["I64","LSDatabaseSingleton","MAWBridgeSendAndReceive","MAWMpsGating","MAWThreadMappingUtils","MAWUserJidWrapper","WAJids","WAStanzaUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WAJids").createJidUtils({platform:"msgr"});function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=yield(e||(e=o("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue();return r.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.messages.index("messageId").get(t);if(n==null)return null;var r=yield o("MAWThreadMappingUtils").getChatJidFromMappingTable(e,n.threadKey);if(r!=null)return{author:u.toUserJid((s||(s=o("I64"))).to_float(n.senderId).toString()),chat:r,externalId:o("WAStanzaUtils").toStanzaId(n.offlineThreadingId)}});return function(t){return e.apply(this,arguments)}})(),"readonly",void 0,void 0,i.id+":33")}),d.apply(this,arguments)}var m=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(o("MAWMpsGating").isFullMpsEnabled())return c(e);if(o("MAWMpsGating").isMpsMessageRendering()){var t=yield c(e);return t!=null&&o("MAWUserJidWrapper").getMyUserJid()===t.author?{author:"@me",chat:t.chat,externalId:t.externalId}:t}return p(e)});return function(n){return e.apply(this,arguments)}})(),p=function(t){return o("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:t})};l.getProtocolMsgIdByMsgIdUI=m}),98);
__d("MAWSendFileMsgTypes",["WAStanzaUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e}function s(e){return o("WAStanzaUtils").toStanzaId(e)}l.toOfflineAttachmentIDFromStanzaId=e,l.toOfflineAttachmentIDFromString=s}),98);
__d("MAWSecureAttachmentGroupingUtils",["I64","LSIntEnum","MAWSendFileMsgTypes","MessagingAttachmentType","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var n=t.reduce(function(t,n){return(e||(e=o("I64"))).equal(n.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))?t.mediaStagingsImage.push(n):t.mediaStagingsOther.push(n),t},{mediaStagingsImage:[],mediaStagingsOther:[]}),a=n.mediaStagingsImage,i=n.mediaStagingsOther;return[].concat(a,i)}function c(t){var n=new Map,a=t.filter(function(t){return(e||(e=o("I64"))).equal(t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))}),i=a.length;if(i>1){var l=r("uuidv4")();a.forEach(function(e,t){n.set(o("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(e.offlineAttachmentId),{groupId:l,groupIndex:t,groupSize:i})})}return n}function d(e){var t=new Map,n=e.length;if(n>1){var o=r("uuidv4")();e.forEach(function(e,r){t.set(e,{groupId:o,groupIndex:r,groupSize:n})})}return t}l.orderMediaStagingsForGrouping=u,l.generateMediaGroupMetadataForMediaStagings=c,l.generateMediaGroupMetadataForMessageIds=d}),98);
__d("MAWThreadId",["LSMessagingThreadTypeUtil","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.threads).getKeyRange(t));return n==null?void 0:n.threadType}),s.apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=yield e(t,n);return r==null?!1:o("LSMessagingThreadTypeUtil").isArmadilloSecure(r)}),c.apply(this,arguments)}function d(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.threads).getKeyRange(t))}l.isSecureThreadKey=u,l.getThread=d}),98);
__d("MAWForwardMessage",["MAWBridgeSendAndReceive","MAWCreateOneToOneThread","MAWExternalId","MAWGetEphemeralSettings","MAWGetProtocolMsgIdByMsgIdInUI","MAWMessageSendReporter","MAWMiActOnActThreadReady","MAWSecureAttachmentGroupingUtils","MAWThreadId","Promise","WAResultOrError","asyncToGeneratorRuntime","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n,r){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=yield o("MAWThreadId").isSecureThreadKey(e.tables,t);if(!a){var i=yield o("MAWCreateOneToOneThread").call(e,t,void 0,"MAWForwardMessage",r),l=i.jid;return n(l,!0)}var s=yield o("MAWMiActOnActThreadReady").waitForACTThreadReady(e.tables,t,"MAWForwardMessage"),u=s.chatJid;return n(u,!1)}),u.apply(this,arguments)}function c(e,t,n,r,o,a){return p(e,t,n,r,o,void 0,a)}function d(e,t,n,r,o){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i,l){var s=o("MAWSecureAttachmentGroupingUtils").generateMediaGroupMetadataForMessageIds(a);yield(e||(e=n("Promise"))).allSettled([a.map(function(e){return p(t,r,e,i,l,s.get(e))})])}),m.apply(this,arguments)}function p(e,t,n,a,i,l,u){var c=o("MAWExternalId").generateExternalId();return s(e,t,function(s,d){return o("MAWGetProtocolMsgIdByMsgIdInUI").getProtocolMsgIdByMsgIdUI(n).then(function(n){return n!=null?o("MAWGetEphemeralSettings").getEphemeralSetting(s,t).then(function(t){var m=o("MAWBridgeSendAndReceive").sendAndReceive("backend","forwardMsg",{args:{args:{mediaGroupMetadata:l,source:a},chatJid:s,ephemeralSetting:t!=null?t:void 0,externalId:c,isFirstMsg:d,protocolMsgId:n,textWithSubstitutions:u},qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:i});return o("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:s,externalId:c},m,{qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:i},e)}):o("WAResultOrError").makeResult({description:"unexpected null protocolMsgId",messageType:"fixMe"})})},i)}l.maybeCreateNewThreadAndCallback=s,l.forwardMessage=c,l.forwardMessageBatch=d}),98);
__d("VideoFrameBuffer",["HTMLMediaElementReadyStates","getErrorSafe"],(function(t,n,r,o,a,i,l){var e=(function(){function e(e,t,n,r,o,a,i){r===void 0&&(r=null),o===void 0&&(o=null),a===void 0&&(a=null),i===void 0&&(i=null),this.$2=t,this.$1=e,this.$3=n||"contain",this.$6=r,this.$7=o,this.$8=a,this.$9=i}var t=e.prototype;return t.updateFrameBuffer=function(){if(this.$4&&(this.$1.width=this.$4,this.$4=null),this.$5&&(this.$1.height=this.$5,this.$5=null),!(this.$2.readyState<r("HTMLMediaElementReadyStates").HAVE_CURRENT_DATA)){var e=this.$1.clientWidth||this.$1.width,t=this.$1.clientHeight||this.$1.height,n=e,o=t,a=this.$2.videoWidth/this.$2.videoHeight,i=n/o;this.$3==="cover"&&(i*=-1,a*=-1),i>a?n=o*a:i<a&&(o=n/a);var l=this.$1.getContext("2d");if(l instanceof window.CanvasRenderingContext2D)try{if(this.$6||this.$7){var s,u,c,d;l.drawImage(this.$2,(s=this.$8)!=null?s:0,(u=this.$9)!=null?u:0,(c=this.$6)!=null?c:e,(d=this.$7)!=null?d:t,0,0,e,t)}else l.drawImage(this.$2,(e-n)/2,(t-o)/2,n,o)}catch(e){var m=r("getErrorSafe")(e);if(m.name!=="NS_ERROR_NOT_AVAILABLE")throw m}}},t.getDOMNode=function(){return this.$1},t.updateDimensions=function(t,n){this.$4=t,this.$5=n},e})();l.default=e}),98);
__d("generateVideoThumbnails",["CPXComposerConstants","CanvasVideoThumbnail","HTMLMediaElementReadyStates","Promise","VideoFrameBuffer","cr:909281"],(function(t,n,r,o,a,i,l){var e,s=.5625;function u(t,o,a,i,l,s,u,f,g,h){return l===void 0&&(l="contain"),s===void 0&&(s=0),u===void 0&&(u=null),f===void 0&&(f=null),g===void 0&&(g=null),h===void 0&&(h=null),new(e||(e=n("Promise")))(function(e,y){var C=document.createElement("canvas"),b=[],v=0,S=t.duration-s;h!=null&&(S=Math.min(S,h));var R=S/i,L=null,E=null,k,I=f!=null?f:c(u,o),T=g!=null?g:d(u,a),D=m(u,o),x=p(u,a);C.width=I!=null?I:o,C.height=T!=null?T:a;var $=new(r("VideoFrameBuffer"))(C,t,l,I,T,D,x);$.updateFrameBuffer();var P=function(){$.updateFrameBuffer();var e=new(r("CanvasVideoThumbnail"))(C,t,s+(v-1)*R,I,T,D,x);b.push(e),(!L||e.getURL().length>L.getURL().length)&&(L=e,E=_(u,t)),M()},N=function(){if(t.readyState>=r("HTMLMediaElementReadyStates").HAVE_CURRENT_DATA)P();else if(n("cr:909281")!==null)var e=n("cr:909281").listen(t,"loadeddata",function(){e.remove(),P()});else t.addEventListener("loadeddata",P,{once:!0})},M=function(){v===0&&(n("cr:909281")!==null?k=n("cr:909281").listen(t,"seeked",N):t.addEventListener("seeked",N)),v<i?(t.currentTime=s+v*R,v++):(n("cr:909281")!==null?k&&k.remove():t.removeEventListener("seeked",N),e({thumbnails:b,selectedThumbnail:L,croppedThumbnailUri:E}))};if(t.videoWidth===0||t.videoHeight===0){y();return}M()})}function c(e,t){if(e&&e.spherical){if(e.stereoMode==="left-right")return t/2;if(e.projectionType==="cubemap")return t/3}return null}function d(e,t){return e&&e.spherical&&(e.stereoMode==="top-bottom"||e.projectionType==="cubemap")?t/2:null}function m(e,t){return e&&e.spherical&&e.projectionType==="cubemap"?t/3:0}function p(e,t){return e&&e.spherical&&e.projectionType==="cubemap"?t/2:0}function _(e,t){var n=t.videoWidth!=null&&t.videoHeight!=null?t.videoWidth/t.videoHeight:s,r=n<1;if(e==null&&!r){var a=document.createElement("canvas"),i=a.getContext("2d"),l=t.videoWidth,u=t.videoHeight;a.width=l,a.height=u,i.drawImage(t,0,0,l,u);var c=document.createElement("canvas"),d,m;n>=1&&n<1.2?(d=l*(o("CPXComposerConstants").REEL_THUMBNAIL_WIDTH/o("CPXComposerConstants").REEL_THUMBNAIL_HEIGHT),m=u):(d=u,m=l),c.width=d,c.height=m;var p=c.getContext("2d");return p.drawImage(a,0,0,l,u,0,0,d,m),c.toDataURL("image/jpeg")}return null}l.default=u}),98);
__d("MAWVideoUtils",["FBLogger","MAWImageUtils","Promise","generateVideoThumbnails"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var a=document.body;if(!a)return new(e||(e=n("Promise")))(function(e,t){return t("Unable to find DOM body, please use this util only in DOM environment.")});var i=document.createElement("video");return new(e||(e=n("Promise")))(function(o,l){i.setAttribute("style","display: none"),i.setAttribute("src",URL.createObjectURL(t)),i.addEventListener("loadedmetadata",function(t){var a=t.currentTarget;if(a instanceof HTMLVideoElement){var s=a.duration,u=a.videoHeight,c=a.videoWidth,d=r("generateVideoThumbnails")(i,c,u,1);o((e||(e=n("Promise"))).all([d,c,u,Math.round(s)]))}else l("EventTarget returned for event should be HTMLVideoElement")}),i.addEventListener("error",function(e){l("Unable to load video")}),a.appendChild(i)}).then(function(e){var t=e[0],n=e[1],r=e[2],l=e[3];return a.removeChild(i),o("MAWImageUtils").canvasToBlob(t.thumbnails[0].getCanvas(),o("MAWImageUtils").TYPE_JPEG,!0).then(function(e){return e.arrayBuffer().then(function(e){return{duration:l,height:r,jpegThumbnail:e,width:n}})})}).catch(function(e){throw a.removeChild(i),r("FBLogger")("messenger_web").mustfixThrow(e)})}function u(t){var o=document.body;if(!o)return new(e||(e=n("Promise")))(function(e,t){return t("Unable to find DOM body, please use this util only in DOM environment.")});var a=document.createElement("video");return new(e||(e=n("Promise")))(function(e,n){a.setAttribute("style","display: none"),a.setAttribute("src",URL.createObjectURL(t)),a.addEventListener("loadedmetadata",function(t){var r=t.currentTarget;if(r instanceof HTMLVideoElement){var o=r.duration,a=r.videoHeight,i=r.videoWidth;e({duration:Math.round(o),height:a,width:i})}else n("EventTarget returned for event should be HTMLVideoElement")}),a.addEventListener("error",function(e){n("Unable to load video")}),o.appendChild(a)}).catch(function(e){throw o.removeChild(a),r("FBLogger")("messenger_web").mustfixThrow(e)})}l.getVideoThumbnailUrlAndSpec=s,l.getVideoThumbnailSpec=u}),98);
__d("MAWFowardMessageFromOpenThread",["FBLogger","I64","LSIntEnum","MAWAudioUtils","MAWBridgeSendAndReceive","MAWDocumentPreProcess","MAWFetchXMABlob","MAWFetchXMAData","MAWFetchXMADataUtils","MAWForwardMessage","MAWGetEphemeralSettings","MAWGetImageSpec","MAWImagePreProcess","MAWMessageSendReporter","MAWUnshimUrl","MAWVault","MAWVideoUtils","MessagingAttachmentType","Promise","ReQL","WAArmadilloXMA.pb","WABlobToArrayBuffer","asyncToGeneratorRuntime","gkx","qpl","sendToSentQPLLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c="369239263222822",d="369239343222814",m="369239383222810";function p(e){return e===c||e===d||e===m}function _(e,t){return(u||(u=n("Promise"))).all([o("MAWGetImageSpec").getImageSpec_DEPRECATED(e),u.resolve(e),t.arrayBuffer(),o("MAWGetImageSpec").getImageSpec_DEPRECATED(t)]).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0],n=e[1],r=e[2],a=e[3];return{file:n,imageSpec:t,plaintext:yield o("WABlobToArrayBuffer").blobToArrayBuffer(n),thumbnailUrlAndSpec:{duration:void 0,height:a.height,jpegThumbnail:r,width:a.width},type:"image"}});return function(t){return e.apply(this,arguments)}})())}function f(e){return o("MAWVideoUtils").getVideoThumbnailUrlAndSpec(e).then((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){return{file:e,plaintext:yield o("WABlobToArrayBuffer").blobToArrayBuffer(e),thumbnailUrlAndSpec:t,type:"video"}});return function(e){return t.apply(this,arguments)}})())}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"MAWFowardMessageFromOpenThread",url:e}),r=n==null?void 0:new File([n],t,{type:n.type}),a=r!=null?yield o("MAWGetImageSpec").getImageSpec_DEPRECATED(r):null;return r!=null&&a!=null?{file:r,height:a.height,width:a.width}:void 0}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r,a,i=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(n.tables.attachment_ctas).getKeyRange(e));return i==null||t==null&&i.actionUrl==null?null:{actionUrl:(r=i==null?void 0:i.actionUrl)!=null?r:void 0,buttonType:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:(a=i==null?void 0:i.actionUrl)!=null?a:void 0,title:t!=null?t:void 0}}),C.apply(this,arguments)}function b(e,t,n,r){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a){var i=yield S(t,n);if((i==null?void 0:i.actionUrl)==null)throw o("sendToSentQPLLogger").markSendToSentFail(a,"null_xma_url"),r("FBLogger")("messenger_web_sharing").mustfixThrow("Cannot forward XMA to secure threads without a defaultCTA and actionUrl");var l=yield o("MAWFetchXMAData").fetchXMAData(e,i.actionUrl,[a]);if(l.linkType==="unknown")throw o("sendToSentQPLLogger").markSendToSentFail(a,"unknown_xma_link_type"),r("FBLogger")("messenger_web_sharing").mustfixThrow("Cannot forward XMA to secure threads with an unknown link type");return l.linkType==="external"?k(t,i,n,l):L(l,a)}),v.apply(this,arguments)}function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.actionUrl,r=e.defaultCtaId,a=e.defaultCtaTitle;if(r==null)return null;var i=yield y(r,a,t);return i!=null?i:{actionUrl:n!=null?n:void 0,buttonType:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:n!=null?n:void 0,title:a!=null?a:void 0}}),R.apply(this,arguments)}function L(e,t){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("MAWFetchXMADataUtils").makeXMAFileArgs(e,t),r=e.contentRef,a=e.ctas,i=e.defaultCTA,l=e.overlayIconGlyph,s=e.subtitle_text,u=e.title_text,c=e.xma_message_type,d={contentRef:r,ctas:a,defaultCTA:i,overlayIconGlyph:l,subtitleText:s,titleText:u};return babelHelpers.extends({},n,{xmaArgs:d,xmaMessageType:c!=null?c:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE})}),E.apply(this,arguments)}function k(e,t,n,r){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=t.attachmentCta1Id,s=t.attachmentCta2Id,c=t.attachmentCta3Id,d=t.cta1Title,m=t.cta2Title,p=t.cta3Title,_=t.faviconUrl,f=t.headerImageUrl,h=t.headerTitle,C=t.maxSubtitleNumOfLines,b=t.maxTitleNumOfLines,v=t.previewUrl,S=t.subtitleText,R=t.titleText,L=yield(u||(u=n("Promise"))).all([[_,"favicon"],[f,"headerImage"],[v,"preview"]].map(function(e){return g(e[0],e[1])})),E=L[0],k=L[1],I=L[2],T=[];if(l!=null){var D=yield y(l,d,a);D!=null&&T.push(D)}if(s!=null){var x=yield y(s,m,a);x!=null&&T.push(x)}if(c!=null){var $=yield y(c,p,a);$!=null&&T.push($)}var P={contentRef:i.contentRef,ctas:T.map(function(e){return babelHelpers.extends({},e,{actionUrl:o("MAWUnshimUrl").unshimUrl(e.actionUrl),nativeUrl:o("MAWUnshimUrl").unshimUrl(e.nativeUrl)})}),defaultCTA:babelHelpers.extends({},r,{actionUrl:o("MAWUnshimUrl").unshimUrl(r.actionUrl),nativeUrl:o("MAWUnshimUrl").unshimUrl(r.nativeUrl)}),headerTitle:h,maxSubtitleNumOfLines:(e||(e=o("I64"))).to_int32(C!=null?C:(e||(e=o("I64"))).zero),maxTitleNumOfLines:e.to_int32(b!=null?b:(e||(e=o("I64"))).zero),overlayIconGlyph:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE,subtitleText:S,titleText:R};return{faviconFileArgs:E,headerFileArgs:k,previewFileArgs:I,xmaArgs:P,xmaMessageType:i.xma_message_type}}),I.apply(this,arguments)}function T(t){var a=t.attachmentType,i=t.filename,l=t.playableDurationMs,c=t.playableUrl,d=t.playableUrlMimeType,m=t.previewUrl,p=t.previewUrlMimeType;if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))||(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))||(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE))||(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").FILE))){if(c==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("If you see this error, there is no playableUrl for this attachment");var g=(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE));if(m!=null){var h=g?m+"&":c,y=g?m+"&":m;return(u||(u=n("Promise"))).all([window.fetch(h).then(function(e){return e.blob()}),window.fetch(y).then(function(e){return e.blob()})]).then(function(t){var n=t[0],i=t[1],l=new File([n],"mediaForwardedFromOpenThread",{type:g?p:d}),u=new File([i],"previewForwardedFromOpenThread",{type:p});if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE)))return _(l,u);if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO)))return f(l);if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE)))return _(l,u);throw r("FBLogger")("messenger_web_sharing").mustfixThrow("shouldn't have this error in forward message from open thread")})}var C=g?c+"&":c;return window.fetch(C).then(function(e){return e.blob()}).then(function(t){if(g&&d==="video/mp4")throw r("FBLogger")("messenger_web_sharing").mustfixThrow("If you see this error, there is only mp4 url for gif");var l=new File([t],i!=null?i:"mediaForwardedFromOpenThread",{type:d});if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE)))return o("MAWImagePreProcess").imagePreprocess(l,!1);if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO)))return f(l);if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").FILE)))return o("MAWDocumentPreProcess").documentPreprocess(l);if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE)))return(u||(u=n("Promise"))).all([o("MAWImagePreProcess").getJpegThumbnailInfo(l,400),o("MAWGetImageSpec").getImageSpec_DEPRECATED(l),u.resolve(l)]).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0],n=e[1],r=e[2];return{file:r,imageSpec:n,plaintext:yield o("WABlobToArrayBuffer").blobToArrayBuffer(r),thumbnailUrlAndSpec:t,type:"image"}});return function(t){return e.apply(this,arguments)}})());throw r("FBLogger")("messenger_web_sharing").mustfixThrow("shouldn't have this error in forward message from open thread")})}if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO))){if(c!=null)return window.fetch(c+"&").then(function(e){return e.blob()}).then((function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var a=new File([n],"mediaForwardedFromOpenThread",{type:d}),i,s=t.waveformData;if(s!=null&&s!==""&&r("gkx")("20216")){var u=s.split(",").map(Number);if(u.every(function(e){return!Number.isNaN(e)})){var c=o("MAWAudioUtils").recomputeWaveform(u);i=new Uint8Array(c).buffer}else r("FBLogger")("messenger_web_sharing").warn("Waveform data is invalid. Forwarding skipped.")}return{durations:(e||(e=o("I64"))).to_int32(l!=null?l:(e||(e=o("I64"))).zero)/1e3,file:a,isPtt:!0,plaintext:yield o("WABlobToArrayBuffer").blobToArrayBuffer(a),type:"audio",waveform:i}});return function(e){return a.apply(this,arguments)}})());throw r("FBLogger")("messenger_web_sharing").mustfixThrow("If you see this error, there is no playableUrl for this audio attachment")}if((e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").STICKER))){if(c==null&&m==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("If you see this error, there is no url for this sticker");return c!=null?m!=null?(u||(u=n("Promise"))).all([window.fetch(c).then(function(e){return e.blob()}),window.fetch(m).then(function(e){return e.blob()})]).then(function(e){var t=e[0],n=e[1],r=new File([t],"mediaForwardedFromOpenThread",{type:d}),o=new File([n],"previewForwardedFromOpenThread",{type:p});return _(r,o)}):window.fetch(c).then(function(e){return e.blob()}).then(function(e){var t=new File([e],"mediaForwardedFromOpenThread",{type:d});return _(t,t)}):window.fetch(m).then(function(e){return e.blob()}).then(function(e){return o("MAWImagePreProcess").imagePreprocess(new File([e],"previewForwardedFromOpenThread",{type:p}),!0)})}throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We do not support forwarding other media types. Received attachment %d",(s||(s=o("LSIntEnum"))).toNumber(a))}function D(t,a,i,l,u,c,d,m,_){return o("MAWForwardMessage").maybeCreateNewThreadAndCallback(a,i,function(f,g){var h=o("MAWGetEphemeralSettings").getEphemeralSetting(f,i),y=g;return h.then(function(i){if(c!=null){if(p(c.attachmentFbid)){var g=o("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMsg",{args:{content:"\uD83D\uDC4D",ephemeralSetting:i!=null?i:void 0,isFirstMsg:y,isForwarded:u,source:d,specialTextSize:1},chatJid:f,externalId:_,qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m});return o("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:f,externalId:_},g,{qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m},a)}return(e||(e=o("I64"))).equal(c.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA))?b(t,c,a,m).then(function(e){var t=e.faviconFileArgs,n=e.headerFileArgs,s=e.previewFileArgs,u=e.xmaArgs,c=e.xmaMessageType,d=l.text,p=o("MAWBridgeSendAndReceive").sendAndReceive("backend","sendXMAShareMsg",{args:{content:d!=null&&o("MAWVault").isVaulted(d)?o("MAWVault").unvault(d):d,ephemeralSetting:i!=null?i:void 0,isFirstMsg:y,isForwarded:!0,xmaMessageType:c!=null?c:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE},chatJid:f,faviconFile:t,headerFile:n,previewFile:s,qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m,xmaArgs:u,xmaMsgExternalId:_});return o("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:f,externalId:_},p,{qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m},a)}):T(c).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n;switch(e.type){case"image":{var l=e.imageSpec,s=e.thumbnailUrlAndSpec;n={args:{ephemeralSetting:i!=null?i:void 0,height:l.height,isFirstMsg:y,isForwarded:u,jpegThumbnail:s==null?void 0:s.jpegThumbnail,jpegThumbnailHeight:s==null?void 0:s.height,jpegThumbnailWidth:s==null?void 0:s.width,source:d,width:l.width},attachmentType:"image",chatJid:f,externalId:_};break}case"video":{var c=e.thumbnailUrlAndSpec;n={args:{duration:c.duration,ephemeralSetting:i!=null?i:void 0,height:c.height,isFirstMsg:y,isForwarded:u,jpegThumbnail:c.jpegThumbnail,jpegThumbnailHeight:c.height,jpegThumbnailWidth:c.width,source:d,width:c.width},attachmentType:"video",chatJid:f,externalId:_};break}case"audio":{var p=e.durations,g=e.isPtt,h=e.waveform;n={args:{duration:Math.round(p),ephemeralSetting:i!=null?i:void 0,isFirstMsg:y,isForwarded:u,isPtt:g,source:d,waveform:h},attachmentType:"audio",chatJid:f,externalId:_};break}case"document":{n={args:{ephemeralSetting:i!=null?i:void 0,filename:e.filename,isFirstMsg:y,isForwarded:u,source:d},attachmentType:"application",chatJid:f,externalId:_};break}}if(n==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We do not support forwarding this attachment type: %s",e.type);var C=o("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMediaMsgV2",babelHelpers.extends({},n,{mimeType:e.file.type,plaintext:(t=e.plaintext)!=null?t:yield o("WABlobToArrayBuffer").blobToArrayBuffer(e.file),qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m}));return o("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:f,externalId:_},C,{qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m},a)});return function(t){return e.apply(this,arguments)}})())}var h=l.text;if(h!=null){var C=o("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMsg",{args:{content:o("MAWVault").isVaulted(h)?o("MAWVault").unvault(h):h,ephemeralSetting:i!=null?i:void 0,isFirstMsg:y,isForwarded:u,source:d},chatJid:f,externalId:_,qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m});return o("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:f,externalId:_},C,{qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:m},a)}throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We do not support forwarding this types")})},m)}l.downloadMediaByUrl=T,l.forwardMessage=D}),98);
__d("LSLocalApplyOptimisticMessageWithAttachments",["LSArrayGetObjectAt","LSLocalApplyOptimisticMessage","LSSetMessageDisplayedContentTypes"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.storedProcedure(n("LSLocalApplyOptimisticMessage"),e[0],e[1],e[2],e[3],e[4],e[5],e[6],void 0,e[7],e[8],e[9],e[10],void 0,e[12],!0).then(function(e){var t;return t=e,r[0]=t[0],r[1]=t[1],t})},function(o){return r[2]=t.i64.of_int32(e[11].length),t.i64.gt(r[2],t.i64.cast([0,0]))?t.loopAsync(r[2],function(o){return r[3]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[11],r[3]).then(function(e){var t;return t=e,r[4]=t[0],r[5]=t[1],t})},function(n){return r[6]=r[4].get("attachment_fbid"),r[7]=r[4].get("offline_attachment_id"),r[8]=r[4].get("attachment_type"),r[9]=r[4].get("filename"),r[10]=r[4].get("filesize"),r[11]=r[4].get("attachment_index"),r[12]=r[4].get("has_media"),r[13]=r[4].get("has_xma"),r[14]=r[4].get("playable_url"),r[15]=r[4].get("playable_url_mime_type"),r[16]=r[4].get("playable_duration_ms"),r[17]=r[4].get("preview_url"),r[18]=r[4].get("preview_url_mime_type"),r[19]=r[4].get("mini_preview"),r[20]=r[4].get("preview_width"),r[21]=r[4].get("preview_height"),r[22]=r[4].get("xma_layout_type"),r[23]=r[4].get("xmas_template_type"),r[24]=r[4].get("cta1_title"),r[25]=r[4].get("cta2_title"),r[26]=r[4].get("cta3_title"),r[27]=r[4].get("image_url"),r[28]=r[4].get("action_url"),r[29]=r[4].get("title_text"),r[30]=r[4].get("subtitle_text"),r[31]=r[4].get("description_text"),r[32]=r[4].get("source_text"),r[33]=r[4].get("original_file_hash"),r[34]=r[4].get("sound_bite_client_sound_key"),r[35]=r[4].get("sound_bite_visual"),r[36]=r[4].get("ephemeral_media_state"),r[37]=r[4].get("waveform_data"),r[38]=r[4].get("sampling_frequency_hz"),r[17]!==void 0?r[39]=r[17]:r[39]=r[14],t.filter(t.db.table(16).fetch([[[e[1],r[0],r[6]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&n.messageId===r[0]&&n.attachmentFbid===r[6]&&t.i64.gt(n.authorityLevel,t.i64.cast([0,20]))}).next().then(function(n){var o=n.done,a=n.value;return o?t.db.table(16).put({threadKey:e[1],messageId:r[0],attachmentFbid:r[6],timestampMs:r[1],offlineAttachmentId:r[7],attachmentType:r[8],filename:r[9],filesize:r[10],attachmentIndex:r[11],hasMedia:r[12],hasXma:r[13],isSharable:!1,playableUrl:r[14],playableUrlMimeType:r[15],playableDurationMs:r[16],previewUrl:r[39],previewUrlMimeType:r[18],miniPreview:r[19],previewWidth:r[20],previewHeight:r[21],xmaLayoutType:r[22],xmasTemplateType:r[23],cta1Title:r[24],cta2Title:r[25],cta3Title:r[26],imageUrl:r[27],actionUrl:r[28],titleText:r[29],subtitleText:r[30],descriptionText:r[31],sourceText:r[32],ephemeralMediaState:r[36],originalFileHash:r[33],authorityLevel:t.i64.cast([0,20]),samplingFrequencyHz:r[38],waveformData:r[37]}):0})}])}):t.resolve()},function(o){return r[2]=t.i64.of_int32(e[11].length),t.i64.gt(r[2],t.i64.cast([0,0]))?t.storedProcedure(n("LSSetMessageDisplayedContentTypes"),e[1],r[0],r[1],e[3],!1,t.i64.neq(e[6],void 0)):t.resolve()},function(e){var t;return t=[r[0],r[1]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxLocalApplyOptimisticMessageWithAttachmentsStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);
__d("LSLocalApplyOptimisticMessageWithAttachmentsStoredProcedure",["LSLocalApplyOptimisticMessageWithAttachments","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSLocalApplyOptimisticMessageWithAttachments"),a.senderId,a.threadKey,a.threadType,a.text,a.snippet,a.snippetHasEmoji,a.stickerId,a.replySourceId,a.replySourceType,a.replySourceTypeV2,a.isForwarded,a.attachments,a.mentionData);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSOptimisticSendXMAMessageForwardFromSecureThread",["LSArrayGetObjectAt","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSSetMessageDisplayedContentTypes","LSUpdateOptimisticAttachmentPreview"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.storedProcedure(n("LSLocalApplyOptimisticMessage"),e[0],e[1],e[2],e[3],void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,3]),e[4],void 0,void 0,!0).then(function(e){var t;return t=e,r[0]=t[0],r[1]=t[1],t})},function(o){return r[3]=t.i64.of_int32(e[6].length),t.i64.gt(r[3],t.i64.cast([0,0]))?t.loopAsync(r[3],function(o){return r[4]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[6],r[4]).then(function(e){var t;return t=e,r[5]=t[0],r[6]=t[1],t})},function(o){return r[7]=r[5].get("attachment_fbid"),r[8]=r[5].get("offline_attachment_id"),r[9]=r[5].get("attachment_type"),r[10]=r[5].get("filename"),r[11]=r[5].get("filesize"),r[12]=r[5].get("attachment_index"),r[13]=r[5].get("has_media"),r[14]=r[5].get("has_xma"),r[15]=r[5].get("playable_url"),r[16]=r[5].get("playable_url_mime_type"),r[17]=r[5].get("playable_duration_ms"),r[18]=r[5].get("preview_url"),r[19]=r[5].get("preview_url_mime_type"),r[20]=r[5].get("mini_preview"),r[21]=r[5].get("preview_width"),r[22]=r[5].get("preview_height"),r[23]=r[5].get("xma_layout_type"),r[24]=r[5].get("xmas_template_type"),r[25]=r[5].get("cta1_title"),r[26]=r[5].get("cta2_title"),r[27]=r[5].get("cta3_title"),r[28]=r[5].get("image_url"),r[29]=r[5].get("action_url"),r[30]=r[5].get("title_text"),r[31]=r[5].get("subtitle_text"),r[32]=r[5].get("description_text"),r[33]=r[5].get("source_text"),r[34]=r[5].get("original_file_hash"),r[35]=r[5].get("sound_bite_client_sound_key"),r[36]=r[5].get("sound_bite_visual"),r[37]=r[5].get("ephemeral_media_state"),t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[1],r[0],r[7]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&n.messageId===r[0]&&n.attachmentFbid===r[7]&&t.i64.lt(n.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(n){return t.db.table(16).add({threadKey:e[1],messageId:r[0],attachmentFbid:r[7],timestampMs:r[1],offlineAttachmentId:r[8],attachmentType:r[9],filename:r[10],filesize:r[11],attachmentIndex:r[12],hasMedia:r[13],hasXma:r[14],isSharable:!1,playableUrl:r[15],playableUrlMimeType:r[16],playableDurationMs:r[17],previewUrl:r[18],previewUrlMimeType:r[19],miniPreview:r[20],previewWidth:r[21],previewHeight:r[22],xmaLayoutType:r[23],xmasTemplateType:r[24],cta1Title:r[25],cta2Title:r[26],cta3Title:r[27],imageUrl:r[28],actionUrl:r[29],titleText:r[30],subtitleText:r[31],descriptionText:r[32],sourceText:r[33],ephemeralMediaState:r[37],originalFileHash:r[34],authorityLevel:t.i64.cast([0,20])})},function(o){return t.storedProcedure(n("LSSetMessageDisplayedContentTypes"),e[1],r[0],r[1],e[3],!1,!1)},function(o){return t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],r[0],r[7],r[15],void 0,void 0,r[16],r[18],void 0,void 0,r[19],r[21],r[22],r[30])}])}])}):t.resolve()},function(o){return t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),t.i64.cast([0,1]),void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[2]=t[0],t})},function(n){return t.db.table(31).add({taskId:r[2],threadKey:e[1],offlineThreadingId:r[0],threadAttributionSource:e[5],sendType:t.i64.cast([0,11]),markThreadRead:!1})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure",e.__tables__=["attachments","messages_optimistic_context"],a.exports=e}),null);
__d("LSOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure",["LSOptimisticSendXMAMessageForwardFromSecureThread","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticSendXMAMessageForwardFromSecureThread"),a.senderId,a.threadKey,a.threadType,a.text,a.isForwarded,a.source,a.attachments);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWForwardMessageFromSecureThread.react",["FBLogger","I64","LSFactory","LSHotEmojiSize","LSInsertNewMediaSendStoredProcedure","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsStoredProcedure","LSMailboxType","LSMarkSubJobCompletedV2StoredProcedure","LSOptimisticSendMessageV2StoredProcedure","LSOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure","LSShape","LSVec","MAWAudioUtils","MAWBridgeSendAndReceive","MAWDbMedia","MAWMpsGating","MWPComposerMediaUploadUtil","MWPOpenComposerUtils","MessagePowerUp","MessagingAttachmentType","OfflineThreadingId","Promise","ReQL","WAHashUtils","asyncToGeneratorRuntime","cr:2472","cr:332","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=function(){return o("MAWMpsGating").isMpsMessageRendering()};function d(e,t,n){return{action_url:void 0,attachment_fbid:t,attachment_index:(u||(u=o("I64"))).zero,attachment_type:e.attachmentType,cta1_title:void 0,cta2_title:void 0,cta3_title:void 0,description_text:void 0,filename:e.filename,filesize:void 0,has_media:!0,has_xma:!1,image_url:void 0,mini_preview:void 0,offline_attachment_id:t,original_file_hash:void 0,playable_duration_ms:e.playableDurationMs,playable_url:URL.createObjectURL(n),playable_url_mime_type:n.type,preview_height:void 0,preview_url:void 0,preview_url_mime_type:void 0,preview_width:void 0,source_text:void 0,subtitle_text:void 0,title_text:void 0,waveform_data:e.waveformData,xma_layout_type:void 0,xmas_template_type:void 0}}function m(e,t,n,r){var a;return{action_url:(a=t==null?void 0:t.actionUrl)!=null?a:t==null?void 0:t.nativeUrl,attachment_fbid:n,attachment_index:(u||(u=o("I64"))).zero,attachment_type:e.attachmentType,cta1_title:e.cta1Title,cta2_title:e.cta2Title,cta3_title:e.cta3Title,description_text:e.descriptionText,filename:e.filename,filesize:e.filesize,has_media:!1,has_xma:!0,image_url:void 0,mini_preview:void 0,offline_attachment_id:n,original_file_hash:void 0,playable_duration_ms:void 0,playable_url:r!=null?URL.createObjectURL(r):void 0,playable_url_mime_type:r==null?void 0:r.type,preview_height:void 0,preview_url:r!=null?URL.createObjectURL(r):void 0,preview_url_mime_type:r==null?void 0:r.type,preview_width:void 0,source_text:e.sourceText,subtitle_text:e.subtitleText,title_text:e.titleText,xma_layout_type:e.xmaLayoutType,xmas_template_type:e.xmasTemplateType}}function p(t,a,i,l,s,u,c,d){var m=r("LSFactory")(d);return r("LSOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure")(m,{attachments:r("LSVec").ofArray([o("LSShape").ofRecord(u)]),isForwarded:s,senderId:t,source:c,text:l!=null?l:void 0,threadKey:a,threadType:i}).then(function(){return(e||(e=n("Promise"))).resolve()})}function _(e,t){if(t!=null)return{amplitudes:t.split(",").map(parseFloat),sampling_freq:e!=null?e:o("MAWAudioUtils").WAVEFORM_SAMPLE_RATE}}function f(t,a,l,c,d,m,p,f,g){var h=r("LSFactory")(f);return r("LSLocalApplyOptimisticMessageWithAttachmentsStoredProcedure")(h,{attachments:r("LSVec").ofArray([o("LSShape").ofRecord(a)]),isForwarded:m,senderId:p,threadKey:d,threadType:c}).then(function(t){var r=t[0],a=t[1];return f.messages_optimistic_context.add({externalAttachmentUrl:void 0,initiatingSource:void 0,markThreadRead:!1,messageId:void 0,offlineThreadingId:r,platformRef:void 0,platformToken:void 0,replySourceId:void 0,replySourceType:void 0,sendType:void 0,skipUrlPreviewGen:void 0,taskId:(u||(u=o("I64"))).of_string(r),threadAttributionSource:g,threadKey:d}).then(function(){return(e||(e=n("Promise"))).resolve(r)})}).then(function(t){var i=a.attachment_fbid;return r("LSInsertNewMediaSendStoredProcedure")(h,{attachmentType:a.attachment_type,inMessageIndex:(u||(u=o("I64"))).zero,isSecure:!1,offlineAttachmentId:i,offlineThreadingId:t,sendByServer:!1,shouldTranscode:!1,useDoublePhase:!1}).then(function(){return(e||(e=n("Promise"))).resolve([t,i])})}).then(function(e){var n=e[0],c=e[1],d=function(a,l){l==null||l.length===0||r("promiseDone")(t.runInTransaction(function(e){var t=r("LSFactory")(e);return r("LSMarkSubJobCompletedV2StoredProcedure")(t,{fbid:(u||(u=o("I64"))).of_string(l),offlineAttachmentId:c}).then(function(){return o("MWPOpenComposerUtils").resumeSendJob(t,n)})},"readwrite",void 0,void 0,i.id+":227"))};return o("MWPComposerMediaUploadUtil").startUpload(void 0,void 0,d,void 0,(u||(u=o("I64"))).equal(a.attachment_type,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO)),[l],[c],void 0,void 0,_(a.sampling_frequency_hz,a.waveform_data),void 0,void 0)})}function g(e,t,n,r,o,a,i,l,s){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,l,g,h,y,C,b,v){if(y!=null){var S=y.attachmentType;if(!((u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO))||(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))||(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))||(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE))||(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").FILE))||(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA))))throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We do not support forwarding this type");var R=null;if(!(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA))&&(isFinite(y.attachmentFbid)?R=yield o("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByMediaId",{description:"MAWForwardMessageFromSecureThread",mediaId:o("MAWDbMedia").convertNumberToMediaId(Number.parseInt(y.attachmentFbid,10))}):R=yield o("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByHashedPlaintextHash",{description:"MAWForwardMessageFromSecureThread",plaintextHash:o("WAHashUtils").stringToPlaintextHash(y.attachmentFbid)}).then(function(e){return n("cr:332")!=null&&n("cr:332").runBlobReadAndCompareResult({fileName:y.attachmentFbid,idbBlob:e}),e}),R==null))return;yield t.runInTransaction(function(i){switch(!0){case(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO)):{var L;if(R==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("Blob can not be null for MessagingAttachmentType.AUDIO");var E=new File([R],"mediaForwardedFromSecureThread",{type:R.type}),k=o("OfflineThreadingId").createOfflineThreadingID(),I=o("MWPComposerMediaUploadUtil").getAudioAttachment(k,E,(u||(u=o("I64"))).to_int32((L=y.playableDurationMs)!=null?L:(u||(u=o("I64"))).zero)/1e3,_(y.samplingFrequencyHz!=null?(u||(u=o("I64"))).to_int32(y.samplingFrequencyHz):void 0,y.waveformData));return f(t,I,E,l,a,h,C,i,b)}case(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA)):{var T;return o("ReQL").firstAsync(o("ReQL").fromTableDescending(i.attachment_ctas).getKeyRange((T=y.defaultCtaId)!=null?T:(u||(u=o("I64"))).zero)).then(function(t){var a,i=y.xmaPreviewFbid;if(i==null)return r("FBLogger")("messenger_web_sharing").mustfix("XMA preview fbid is null when forwarding XMA"),(e||(e=n("Promise"))).resolve([t,void 0]);if(c())a=o("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByHashedPlaintextHash",{description:"MAWForwardMessageFromSecureThread",plaintextHash:o("WAHashUtils").stringToPlaintextHash(i)}).then(function(e){return n("cr:332")!=null&&n("cr:332").runBlobReadAndCompareResult({fileName:y.attachmentFbid,idbBlob:e}),e});else try{a=o("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByMediaId",{description:"MAWForwardMessageFromSecureThread",mediaId:o("MAWDbMedia").convertNumberToMediaId(Number.parseInt(i,10))})}catch(o){var l=r("getErrorSafe")(o);return r("FBLogger")("messenger_web_sharing").mustfix("XMA preview fbid is not a valid mediaId when forwarding XMA %s",l.message),(e||(e=n("Promise"))).resolve([t,void 0])}return a.then(function(r){return(e||(e=n("Promise"))).resolve([t,r])}).catch(function(o){return r("FBLogger")("messenger_web_sharing").catching(o).warn("Unable to getBlobDataUrlByXMAId, from MAWForwardMessageFromSecureThread"),(e||(e=n("Promise"))).resolve([t,void 0])})}).then(function(e){var t=e[0],r=e[1],s=null;r!=null&&(s=new File([r],"xmaForwardedFromSecureThread",{type:r.type}));var u=o("OfflineThreadingId").createOfflineThreadingID(),c=m(y,t,u,s),d=g.text,_=n("cr:2472")==null||d==null?d:n("cr:2472").unvault(d);return p(C,a,l,v!=null?v:_,h,c,b,i)})}case(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").FILE)):case(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE)):case(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO)):case(u||(u=o("I64"))).equal(S,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE)):{var D;if(R==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("Blob can not be null for MessagingAttachmentType.AUDIO");var x=new File([R],(D=y.filename)!=null?D:"mediaForwardedFromSecureThread",{type:R.type}),$=o("OfflineThreadingId").createOfflineThreadingID(),P=d(y,$,x);return f(t,P,x,l,a,h,C,i,b)}default:throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We do not support forwarding this type")}},"readwrite",void 0,void 0,i.id+":342")}else{var L=g.text;if(L==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We do not support forwarding this type");var E=n("cr:2472")==null?L:n("cr:2472").unvault(L),k=E==="\uD83D\uDC4D"&&g.hotEmojiSize!=null&&(u||(u=o("I64"))).equal(g.hotEmojiSize,(s||(s=o("LSIntEnum"))).ofNumber(r("LSHotEmojiSize").SMALL)),I=k?(u||(u=o("I64"))).of_string("369239263222822"):void 0;yield t.runInTransaction(function(e){return r("LSOptimisticSendMessageV2StoredProcedure")(r("LSFactory")(e),{extraSendMessageParams:o("LSShape").ofRecord({calculate_denormalizations:!1,is_forwarded:h,mark_read:!1,power_up_style:(s||(s=o("LSIntEnum"))).ofNumber(r("MessagePowerUp").NONE),source:b,sticker_id:I}),mailboxType:s.ofNumber(r("LSMailboxType").MESSENGER),senderId:C,text:k?void 0:v!=null?v:E,threadKey:a,threadType:l})},"readwrite",void 0,void 0,i.id+":553")}}),h.apply(this,arguments)}l.getMediaAttachment=d,l.uploadAndSendMediaToOpenThread=f,l.forwardMessage=g}),98);
__d("forwardAttachmentFromInstamadilloToOpen",["I64","LSIntEnum","MAWForwardMessageFromSecureThread.react","OfflineThreadingId","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentFromInstamadilloToOpen");function c(e,t,n,r,o,a){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a,i,l){var c=yield u.load(),d=yield c(),m=o("OfflineThreadingId").createOfflineThreadingID(),p={attachment_fbid:m,attachment_index:(e||(e=o("I64"))).zero,attachment_type:t.attachmentType,filename:t.filename,has_media:!0,has_xma:!1,offline_attachment_id:m,playable_duration_ms:t.playableDurationMs,playable_url:URL.createObjectURL(n),playable_url_mime_type:n.type,preview_height:t.previewHeight,preview_url:URL.createObjectURL(n),preview_width:t.previewWidth};yield d.runInTransaction(function(t){return o("MAWForwardMessageFromSecureThread.react").uploadAndSendMediaToOpenThread(d,p,n,(s||(s=o("LSIntEnum"))).ofNumber(a),(e||(e=o("I64"))).of_string(r),!0,i,t,l)},"readwrite")}),d.apply(this,arguments)}l.default=c}),98);
__d("forwardAttachmentToInstamadillo",["I64","IGDBridgedAPI","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSPendingTasksPluginType","LSShape","LSVec","OfflineThreadingId","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentToInstamadillo");function c(e,t,n,r,o,a,i){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,c,d,m){var p=yield u.load(),_=yield p(),f=o("OfflineThreadingId").createOfflineThreadingID(),g={attachment_fbid:f,attachment_index:(e||(e=o("I64"))).zero,attachment_type:t.attachmentType,filename:t.filename,has_media:!0,has_xma:!1,offline_attachment_id:f,playable_duration_ms:t.playableDurationMs,playable_url:URL.createObjectURL(a),playable_url_mime_type:a.type,preview_height:t.previewHeight,preview_url:URL.createObjectURL(a),preview_width:t.previewWidth},h=yield _.runInTransaction((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield r("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(r("LSFactory")(t),{extraSendMessageParams:o("LSShape").ofRecord({attachments:r("LSVec").ofArray([o("LSShape").ofRecord(g)]),is_forwarded:!0,mark_read:!1,plugin_type:(s||(s=o("LSIntEnum"))).ofNumber(r("LSPendingTasksPluginType").IGD_INSTAMADILLO),source:d}),senderId:c,threadKey:(e||(e=o("I64"))).of_string(i),threadType:s.ofNumber(l)}),a=n[0];return yield t.messages_optimistic_context.add({markThreadRead:!1,offlineThreadingId:a,openEb:m,taskId:e.of_string(a),threadAttributionSource:d,threadKey:e.of_string(i)}),a});return function(e){return t.apply(this,arguments)}})(),"readwrite");return yield r("IGDBridgedAPI").sendMediaMessage({offlineThreadingId:h}),h}),d.apply(this,arguments)}l.default=c}),98);
__d("LSOptimisticSendAttachmentForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSUpdateOptimisticAttachmentPreview"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[1]=e[3]===""?void 0:e[3],r[1]!==void 0?t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[1],r[1]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&n.messageId===r[1]&&t.i64.eq(n.authorityLevel,t.i64.cast([0,20]))}),function(n){var r=n.update,o=n.item;return r({attachmentFbid:t.i64.to_string(e[7])})})},function(e){return r[0]=r[1]}]):t.sequence([function(o){return t.storedProcedure(n("LSLocalApplyOptimisticMessage"),e[0],e[1],e[2],e[4],e[5],e[6],void 0,void 0,void 0,void 0,t.i64.cast([0,3]),void 0,void 0,void 0,!0).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],t})},function(o){return t.filter(t.db.table(16).fetch(),function(n){return n.attachmentFbid===t.i64.to_string(e[7])}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],r[3],r[2],r[2],t.i64.to_string(e[7]),t.i64.cast([0,2]),void 0,t.i64.cast([0,0]),void 0,!0,!1):(a=l.item,t.sequence([function(o){return t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],r[3],r[2],r[2],t.i64.to_string(e[7]),a.attachmentType,a.filename,a.attachmentIndex,a.attributionAppId,!0,!1)},function(o){return t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],r[2],t.i64.to_string(e[7]),a.playableUrl,a.playableUrlFallback,a.playableUrlExpirationTimestampMs,a.playableUrlMimeType,a.previewUrl,a.previewUrlFallback,a.previewUrlExpirationTimestampMs,a.previewUrlMimeType,a.previewWidth,a.previewHeight,a.titleText)}]))})},function(e){return r[0]=r[2]}])},function(o){return t.sequence([function(n){return r[2]=t.createArray(),r[6]=(r[2].push(e[7]),r[2]),t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[3]=t.i64.cast([0,1]):(n=a.item,r[7]=n.syncGroup,t.i64.neq(r[7],void 0)?r[6]=r[7]:r[6]=t.i64.cast([0,1]),r[3]=r[6])})},function(o){return t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),r[3],void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[5]=t[0],t})},function(n){return t.db.table(31).add({taskId:r[5],threadKey:e[1],offlineThreadingId:r[0],threadAttributionSource:e[8],sendType:t.i64.cast([0,4]),markThreadRead:!1,initiatingSource:e[9]})}])},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticSendAttachmentForwardStoredProcedure",e.__tables__=["attachments","threads","messages_optimistic_context"],a.exports=e}),null);
__d("LSOptimisticSendAttachmentForwardStoredProcedure",["LSOptimisticSendAttachmentForward","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticSendAttachmentForward"),a.senderId,a.threadKey,a.threadType,a.offlineThreadingId,a.text,a.snippet,a.snippetHasEmoji,a.forwardedAttachmentFbid,a.source,a.initiatingSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("forwardAttachmentToOpen",["I64","LSFactory","LSIntEnum","LSOptimisticSendAttachmentForwardStoredProcedure","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentToOpen");function c(e,t,n,r,o){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l){var c=yield u.load(),d=yield c(),m=yield d.runInTransaction(function(u){return r("LSOptimisticSendAttachmentForwardStoredProcedure")(r("LSFactory")(u),{forwardedAttachmentFbid:(e||(e=o("I64"))).of_string(t),senderId:i,source:l,threadKey:e.of_string(n),threadType:(s||(s=o("LSIntEnum"))).ofNumber(a)})},"readwrite"),p=m[0];return p}),d.apply(this,arguments)}l.default=c}),98);
__d("forwardAttachment",["FBLogger","I64","MAWDbMedia","MAWFowardMessageFromOpenThread","Promise","asyncToGeneratorRuntime","forwardAttachmentFromInstamadilloToOpen","forwardAttachmentToInstamadillo","forwardAttachmentToOpen","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachment");function c(e,t,n,r,o,a){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,c,d){var m=yield u.load(),p=yield m(),_=yield p.tables.e2ee_media.get(o("MAWDbMedia").convertToMediaId64((s||(s=o("I64"))).of_float(Number.parseInt(t.attachmentFbid,10)))),f,g=!1;if(_!=null){var h=yield p.tables.e2ee_chunk.index("hashedPlaintextHash").get(_.hashedPlaintextHash);if(h!=null){var y=new Blob([h.blobData],{type:h.mimetype});f=new File([y],"IGDForwardFromSecureThread-"+t.attachmentFbid,{type:y.type}),g=!0}else return r("FBLogger")("igd_web").mustfix("Missing chunk for e2ee media when forwarding an E2EE media message"),(e||(e=n("Promise"))).resolve()}else{var C=yield o("MAWFowardMessageFromOpenThread").downloadMediaByUrl(t);f=C.file}return d!=null&&d.useInstamadilloTransport?r("forwardAttachmentToInstamadillo")(t,f,a,i,l,c,!!(d!=null&&d.useOpenEb)):g?r("forwardAttachmentFromInstamadilloToOpen")(t,f,a,i,l,c):r("forwardAttachmentToOpen")(t.attachmentFbid,a,i,l,c)}),d.apply(this,arguments)}l.default=c}),98);
__d("LSOptimisticSendMessageForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSPredefineTraceForTask","LSUpdateOptimisticAttachmentPreview"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.filter(t.db.table(12).fetch([[[e[3],e[4],e[5]]]]),function(n){return t.i64.eq(n.threadKey,e[3])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.timestampMs,e[4])&&n.messageId===e[5]&&t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[3]=t.createArray(),r[4]=(r[3].push("optimisticSendMessageForward msg not found"),r[3]),r[5]=(r[3].push(e[5]),r[3]),r[6]=t.toJSON(r[3]),(function(e){t.logger(e).mustfix(e)})(r[6]),i=["",t.i64.cast([-1,4294967295])],r[0]=i[0],r[1]=i[1]):(a=s.item,t.sequence([function(o){return r[11]=a.forwardScore,r[3]=a.text,r[4]=r[11],t.storedProcedure(n("LSLocalApplyOptimisticMessage"),e[0],e[1],e[2],r[3],void 0,void 0,a.stickerId,a.hotEmojiSize,void 0,void 0,t.i64.cast([0,3]),void 0,r[4],void 0,!0).then(function(e){var t;return t=e,r[5]=t[0],r[6]=t[1],t})},function(o){return t.forEach(t.db.table(16).fetch([[[a.threadKey,a.messageId]]]),function(o){var a=o.item;return t.sequence([function(o){return r[16]=a.attachmentFbid,r[12]=t.createArray(),r[13]=(r[12].push(r[16]),r[12]),r[14]=(r[12].push(r[5]),r[12]),r[15]=t.toJSON(r[12]),t.storedProcedure(n("LSInsertOptimisticAttachment"),e[1],r[6],r[5],r[16],r[15],a.attachmentType,a.filename,a.attachmentIndex,void 0,a.hasMedia,a.hasXma)},function(o){return t.storedProcedure(n("LSUpdateOptimisticAttachmentPreview"),e[1],r[5],r[15],a.playableUrl,a.playableUrlFallback,a.playableUrlExpirationTimestampMs,a.playableUrlMimeType,a.previewUrl,a.previewUrlFallback,a.previewUrlExpirationTimestampMs,a.previewUrlMimeType,a.previewWidth,a.previewHeight,a.titleText)}])})},function(n){return t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[7]=t.i64.cast([0,1]):(n=a.item,r[13]=n.syncGroup,t.i64.neq(r[13],void 0)?r[12]=r[13]:r[12]=t.i64.cast([0,1]),r[7]=r[12])})},function(o){return t.storedProcedure(n("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),t.i64.to_string(e[1]),t.i64.cast([0,46]),"",void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),r[7],void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[9]=t[0],t})},function(e){return t.resolve()},function(n){return t.db.table(31).add({taskId:r[9],threadKey:e[1],offlineThreadingId:r[5],messageId:e[5],threadAttributionSource:e[6],sendType:t.i64.cast([0,5]),markThreadRead:!1,initiatingSource:e[7]})},function(n){var o;return r[12]=new t.Map,r[13]=r[12].set("optimisticSendMessageForward",e[1]),r[14]=r[12].set("fwdMsgID",e[5]),r[15]=t.toJSON(r[12]),r[10]=r[15],(function(e){t.logger(e).info(e)})(r[10]),o=[r[5],r[9]],r[0]=o[0],r[1]=o[1]}]))})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticSendMessageForwardStoredProcedure",e.__tables__=["messages","attachments","threads","messages_optimistic_context"],a.exports=e}),null);
__d("LSOptimisticSendMessageForwardStoredProcedure",["LSOptimisticSendMessageForward","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticSendMessageForward"),a.senderId,a.threadKey,a.threadType,a.forwardedMsgThreadKey,a.forwardedMsgTimestampMs,a.forwardedMsgId,a.source,a.initiatingSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("forwardAttachmentCollectionToOpen",["I64","LSFactory","LSIntEnum","LSOptimisticSendMessageForwardStoredProcedure","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentCollectionToOpen");function c(e,t,n,r,o){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l){var c=yield u.load(),d=yield c(),m=yield d.runInTransaction(function(u){return r("LSOptimisticSendMessageForwardStoredProcedure")(r("LSFactory")(u),{forwardedMsgId:t.messageId,forwardedMsgThreadKey:t.threadKey,forwardedMsgTimestampMs:t.timestampMs,initiatingSource:void 0,senderId:i,source:l,threadKey:(e||(e=o("I64"))).of_string(n),threadType:(s||(s=o("LSIntEnum"))).ofNumber(a)})},"readwrite"),p=m[0];return p}),d.apply(this,arguments)}l.default=c}),98);
__d("forwardText",["I64","LSFactory","LSIntEnum","LSMailboxType","LSOptimisticSendMessageV2StoredProcedure","LSPendingTasksPluginType","LSShape","MessagePowerUp","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardText"),c={calculate_denormalizations:!1,is_forwarded:!0,mark_read:!1,power_up_style:(e||(e=o("LSIntEnum"))).ofNumber(r("MessagePowerUp").NONE)};function d(e,t,n,r,o,a){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,d){var m=yield u.load(),p=yield m(),_=yield p.runInTransaction(function(u){return r("LSOptimisticSendMessageV2StoredProcedure")(r("LSFactory")(u),{extraSendMessageParams:o("LSShape").ofRecord(babelHelpers.extends({},c,{openEb:d==null?void 0:d.useOpenEb,plugin_type:d!=null&&d.useInstamadilloTransport?(e||(e=o("LSIntEnum"))).ofNumber(r("LSPendingTasksPluginType").IGD_INSTAMADILLO):void 0,source:l})),mailboxType:(e||(e=o("LSIntEnum"))).ofNumber(r("LSMailboxType").MESSENGER),senderId:i,text:t,threadKey:(s||(s=o("I64"))).of_string(n),threadType:e.ofNumber(a)})},"readwrite"),f=_[0];return f}),m.apply(this,arguments)}l.default=d}),98);
__d("forwardXMAFromInstamadillo",["asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("getSendPostToInstamadilloRecipient").__setRef("forwardXMAFromInstamadillo"),s=r("requireDeferred")("getSendProfileToInstamadilloRecipient").__setRef("forwardXMAFromInstamadillo"),u=r("requireDeferred")("getSendReelToInstamadilloRecipient").__setRef("forwardXMAFromInstamadillo");function c(e,t,n,r){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,o){if(n!=null){var a=JSON.parse(n);switch(a.__typename){case"XMSGIgReceiverFetchXmaFeedFetchParams":{var i=yield e.load(),l=i(a.media_igid,void 0,r,o,!0);yield l(t.id,t.isDisappearingModeSettingOn,t.isTTLCMediaShareEnabled);break}case"XMSGIgReceiverFetchXmaClipFetchParams":{var c=yield u.load(),d=c(a.media_igid,void 0,r,o,!0);yield d(t.id,t.isDisappearingModeSettingOn,t.isTTLCMediaShareEnabled);break}case"XMSGIgReceiverFetchXmaProfileFetchParams":{var m=yield s.load(),p=m(a.igid,void 0,r,o,!0);yield p(t.id,t.isDisappearingModeSettingOn,t.isTTLCGenericXMAShareEnabled);break}}}}),d.apply(this,arguments)}l.default=c}),98);
__d("forwardXMAUtils",["FBLogger","IGDInstamadilloUtils","IGDThreadTTLCUtils","URI","getErrorSafe","isLinkshimURI"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=new(e||(e=r("URI")))(t);return r("isLinkshimURI")(n)&&(n=new(e||(e=r("URI")))(n.getQueryData().u)),n.toString()}function u(e,t){return e==="igd_web_post_share"&&t.includes("instagram.com/p/")}function c(e,t){return e==="xma_open_native"&&t.includes("https://www.instagram.com")}function d(e,t,n,a){if(e==null)return!1;var i=o("IGDInstamadilloUtils").isInstamadilloMessage(t);if(i&&t.xmaReceiverFetchParams!=null){var l;try{l=JSON.parse(t.xmaReceiverFetchParams)}catch(e){return r("FBLogger")("igd_web").mustfix("forwardXMAUtils: failed to parse message xmaReceiverFetchParams with error %s.",r("getErrorSafe")(e).message),!1}return o("IGDThreadTTLCUtils").isXmaReceiverFetchTTLCEnabled(l,e)}if(a==null||(a==null?void 0:a.actionUrl)==null)return!1;var d=s(a.actionUrl);return u(n==null?void 0:n.defaultCtaType,d)?o("IGDThreadTTLCUtils").isInstamadilloTTLCMediaShareEnabled(e):c(n==null?void 0:n.defaultCtaType,d)?o("IGDThreadTTLCUtils").isInstamadilloTTLCGenericXmaEnabled(e):!1}l.linkshimDecode=s,l.isFeedXma=u,l.isProfileXma=c,l.shouldForwardXMAViaTTLC=d}),98);
__d("forwardXMAFromOpenToInstamadillo",["FBLogger","I64","PolarisDirectAPI","PolarisLinkshimURI","URI","asyncToGeneratorRuntime","forwardXMAUtils","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("getSendPostToInstamadilloRecipient").__setRef("forwardXMAFromOpenToInstamadillo"),c=r("requireDeferred")("getSendProfileToInstamadilloRecipient").__setRef("forwardXMAFromOpenToInstamadillo"),d=function(t){var e=new(s||(s=r("URI")))(t);return o("PolarisLinkshimURI").shouldSkipLinkShim(t)&&(e=new(s||(s=r("URI")))(e.getQueryData().u)),e.toString()};function m(e,t,n,r,o,a){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,s){var m=d(l);if(o("forwardXMAUtils").isFeedXma(n.defaultCtaType,m)&&a!=null){var p=yield u.load(),_=p((e||(e=o("I64"))).to_string(a),void 0,i,m,!0);yield _(t.id,t.isDisappearingModeSettingOn,s)}if(o("forwardXMAUtils").isProfileXma(n.defaultCtaType,m)){if(i==null)return;try{var f=yield o("PolarisDirectAPI").getUserProfile(i);if(f.status==="ok"){var g,h,y=(g=f.data)==null||(g=g.user)==null?void 0:g.id,C=(h=f.data)==null||(h=h.user)==null?void 0:h.eimu_id;if(y!=null&&C!=null){var b=yield c.load(),v=b(y,C,i,m,!0);yield v(t.id,t.isDisappearingModeSettingOn,s)}}}catch(e){r("FBLogger")("igd_web").mustfix("forwardXMAFromOpenToInstamadillo: failed to call getUserProfile Django API",String(e));return}}}),p.apply(this,arguments)}l.default=m}),98);
__d("forwardXMAOpenToOpen",["I64","LSFactory","LSIntEnum","LSOptimisticSendMessageForwardStoredProcedure","asyncToGeneratorRuntime","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardXMAOpenToOpen");function c(e,t,n,r,o,a,i){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,c,d){var m=yield u.load(),p=yield m(),_=yield p.runInTransaction(function(u){return r("LSOptimisticSendMessageForwardStoredProcedure")(r("LSFactory")(u),{forwardedMsgId:t,forwardedMsgThreadKey:(e||(e=o("I64"))).of_string(c),forwardedMsgTimestampMs:e.of_string(d),senderId:i,source:l,threadKey:e.of_string(n),threadType:(s||(s=o("LSIntEnum"))).ofNumber(a)})},"readwrite"),f=_[0];return f}),d.apply(this,arguments)}l.default=c}),98);
__d("MWChatThreadId",["FBLogger","I64","LSIntEnum"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){switch(e.NAME){case"Group":case"User":case"Page":case"UserSecret":return e.VAL}}function c(e){switch(e.NAME){case"Group":return"g."+e.VAL;case"Page":return"p."+e.VAL;case"User":return"u."+e.VAL;case"UserSecret":throw r("FBLogger")("messenger_web").mustfixThrow("MWChatThreadIdType Not supported")}}function d(e){switch(e.targetType){case"GROUP":return{NAME:"Group",VAL:e.targetID};case"PAGE":return{NAME:"Page",VAL:e.targetID};case"USER":return{NAME:"User",VAL:e.targetID};default:throw r("FBLogger")("messenger_web").mustfixThrow("Invalid id")}}function m(e){return e.NAME==="User"}function p(e){return e.NAME==="UserSecret"}function _(e){if(e!=null){var t=e.split(":");if(t.length===2){var n=t[0],r=t[1];switch(n){case"thread":return{NAME:"Group",VAL:r};case"user":return{NAME:"User",VAL:r};default:return}}}}function f(t){var n=t.NAME;return n==="Group"?(e||(e=o("LSIntEnum"))).ofNumber(2):n==="User"||n==="Page"?(e||(e=o("LSIntEnum"))).ofNumber(1):(e||(e=o("LSIntEnum"))).ofNumber(7)}function g(e){return(s||(s=o("I64"))).of_string(e.VAL)}l.getFBID=u,l.serializeFuture=c,l.fromJs=d,l.isUser=m,l.isSecret=p,l.deserializeFromLegacyThreadId=_,l.getMessagingThreadType=f,l.toThreadKey=g}),98);
__d("useGetForwardSource",["LSIntEnum","LSMessagingThreadAttributionType","MWLSThreadDisplayContext"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();return t!=null?t==="Inbox"?(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_INBOX_FORWARD):t==="ChatTab"?(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_CHAT_FORWARD):(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW):(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW)}l.default=s}),98);
__d("WorkChatMessageType",[],(function(t,n,r,o,a,i){"use strict";var e="text",l="gif",s="sticker",u="audio",c="file",d="hotEmoji";i.text=e,i.gif=l,i.sticker=s,i.audio=u,i.file=c,i.hotEmoji=d}),66);
__d("useMWLSSendStickerMessage",["I64","Int64Hooks","LSFactory","LSIntEnum","LSMailboxType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSOptimisticSendMessageV2StoredProcedure","LSShape","LSThreadAttributionTypeUtil","MWPActor.react","MessagePowerUp","WorkChatMessageType","promiseDone","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,n,a){var l=(u||(u=r("useReStore")))(),c=o("MWPActor.react").useActor();return o("Int64Hooks").useCallbackInt64(function(u,d,m){r("promiseDone")(l.runInTransaction(function(a){var i=o("LSThreadAttributionTypeUtil").getSourceAndResetAttribution(u,t!=null?t:"unknown");return r("LSOptimisticSendMessageV2StoredProcedure")(r("LSFactory")(a),{extraSendMessageParams:o("LSShape").ofRecord({calculate_denormalizations:!0,initiating_source:n,mark_read:!0,optimistic_attachment_preview:o("LSShape").ofRecord({playable_url:void 0,playable_url_expiration_timestamp_ms:void 0,playable_url_fallback:void 0,playable_url_mime_type:void 0,preview_height:(e||(e=o("I64"))).zero,preview_url:m,preview_url_expiration_timestamp_ms:void 0,preview_url_fallback:void 0,preview_url_mime_type:void 0,preview_width:e.zero}),power_up_style:(s||(s=o("LSIntEnum"))).ofNumber(r("MessagePowerUp").NONE),reply_source_id:void 0,reply_source_type:s.ofNumber(r("LSMessageReplySourceType").MESSAGE),reply_source_type_v2:s.ofNumber(r("LSMessageReplySourceTypeV2").MESSAGE),snippet_has_emoji:!1,source:i,sticker_id:e.of_string(d)}),mailboxType:s.ofNumber(r("LSMailboxType").MESSENGER),senderId:c,threadKey:u,threadType:s.ofNumber(1)})},"readwrite",void 0,void 0,i.id+":49").then(function(e){a==null||a(o("WorkChatMessageType").sticker,1,e[0])}))},[l,c,n,t,a])}l.default=c}),98);
__d("MWLSForwardMessage",["I64","Int64Hooks","LSFactory","LSMediaUrlAttachment","LSOptimisticSendAttachmentForwardStoredProcedure","LSOptimisticSendMessageForwardStoredProcedure","MWChatThreadId","MWPActor.react","ODS","Promise","ReQL","promiseDone","useGetForwardSource","useLSMessagingInitiatingSource","useLSMessagingSource","useMWLSSendStickerMessage","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(){var t=(c||(c=r("useReStore")))(),a=o("MWPActor.react").useActor(),l=r("useLSMessagingInitiatingSource")(),d=r("useGetForwardSource")(),m=r("useLSMessagingSource")(),p=r("useMWLSSendStickerMessage")(m,l);return o("Int64Hooks").useCallbackInt64(function(c,m,_){if(_.type==="sent"){var f=_.value,g=f.timestamp,h=f.messageId,y=f.threadId;(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","send");var C=function(){return t.runInTransaction(function(e){return r("LSOptimisticSendMessageForwardStoredProcedure")(r("LSFactory")(e),{forwardedMsgId:h,forwardedMsgThreadKey:y,forwardedMsgTimestampMs:g,initiatingSource:l,senderId:a,source:d,threadKey:c,threadType:m})},"readwrite",void 0,void 0,i.id+":62").then(function(){})};r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.messages).getKeyRange(y,g,h)).then(function(r){if(r==null)return C();var a=r.stickerId;return a!=null?o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.attachments).getKeyRange(y,h)).then(function(t){var r=t!=null?o("LSMediaUrlAttachment").previewUrl(t):void 0;return p(c,(u||(u=o("I64"))).to_string(a),r),(e||(e=n("Promise"))).resolve()}):C()}),function(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","success")},function(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","failure")})}},[t,a,l,d,p])}function m(){var e=(c||(c=r("useReStore")))(),t=o("MWPActor.react").useActor(),n=r("useLSMessagingInitiatingSource")(),a=r("useGetForwardSource")();return o("Int64Hooks").useMemoInt64(function(){return(function(l,c,d){(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","send");var m=o("MWChatThreadId").getMessagingThreadType(l),p=o("MWChatThreadId").toThreadKey(l);r("promiseDone")(e.runInTransaction(function(e){return r("LSOptimisticSendAttachmentForwardStoredProcedure")(r("LSFactory")(e),{forwardedAttachmentFbid:(u||(u=o("I64"))).of_string(c),initiatingSource:n,senderId:t,source:a,threadKey:p,threadType:m})},"readwrite",void 0,void 0,i.id+":140"),function(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","success")},function(){return(s||(s=o("ODS"))).bumpEntityKey(3185,"mw_forward","failure")})})},[e,t,n,a])}l.useForwardMessage=d,l.useForwardAttachment=m}),98);
__d("useMWV2ForwardMessage",["$InternalEnum","CometRelay","FBLogger","I64","Int64Hooks","LSIntEnum","LSMessagingThreadTypeUtil","MAWDbMsg","MAWExternalId","MAWThreadId","MAWVault","MAWVerifyThreadCutover","MWChatMessageId","MWChatThreadId","MWLSForwardMessage","MWMediaRenderQplUtils","MWPActor.react","MWSharedMsgLogUtils","MWSharedS2SBaseAnnotations","MWUnvaultedText","Promise","ReQL","ReQLSuspense","WAResultOrError","asyncToGeneratorRuntime","cr:19816","cr:19893","cr:19894","cr:9759","getErrorSafe","promiseDone","react","sendToSentQPLLogger","useGetForwardSource","useIsSecureMessage","useReStore","useStringWithSubstitutions"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=(c||(c=o("react"))).useMemo;function p(e,t,n){var r;return(r=o("ReQL")).firstAsync(r.mergeJoin(r.fromTableAscending(e.tables.participants).getKeyRange(t),r.fromTableAscending(e.tables.contacts)).filter(function(e){var t=e[0],r=e[1];return!(d||(d=o("I64"))).equal(r.id,n)}))}function _(e,t,n){var r=t.messageId,a=t.threadKey,l=o("ReQLSuspense").useArray(function(){return o("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(a,r)},[e,r,a],i.id+":90"),s=o("ReQLSuspense").useFirst(function(){return n!=null?o("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(a,r,n):o("ReQL").empty()},[n,e,r,a],i.id+":99"),u=l.length>0?l[0]:void 0;if(n!=null){var c=s!=null?s:u;return c!=null?[c]:[]}return l}function f(){var t=(s||(s=r("useReStore")))();return o("Int64Hooks").useCallbackInt64((function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a,i,l,s,u,c,d,m,_){var f=o("MWChatThreadId").toThreadKey(u),h=o("MWChatThreadId").getMessagingThreadType(u),y=yield o("MAWVerifyThreadCutover").verifyThreadCutover((e||(e=n("Promise"))).resolve(t),f),C=yield e.all([o("MAWThreadId").isSecureThreadKey(t.tables,f),o("MAWThreadId").getThread(t.tables,f),p(t,f,l)]),b=C[0],v=C[1],S=C[2],R=b||y;try{if(n("cr:19893")!=null&&!R)return o("sendToSentQPLLogger").addSendToSentAnnotations(c,{string:{forward_type:g.SecureToOpen}}),m!=null?yield(e||(e=n("Promise"))).allSettled([m.messagesAndAttachments.map(function(e){var r;return n("cr:19893").forwardMessage(t,f,h,e.message,s,(r=e.attachment)!=null?r:void 0,l,d)})]):yield n("cr:19893").forwardMessage(t,f,h,a,s,i[0],l,d,_),o("sendToSentQPLLogger").markSendToSentSuccess(c),[o("WAResultOrError").makeResult({description:"open message",messageType:"fixMe"})];var L=o("MAWDbMsg").toMsgId(a.messageId);if(L==null)throw r("FBLogger")("messenger_web_sharing").mustfixThrow("Message does not have an id");if(n("cr:19816")!=null){o("sendToSentQPLLogger").addSendToSentAnnotations(c,{string:{forward_type:g.SecureToSecure}});var E;if(m!=null){var k=m.messagesAndAttachments.map(function(e){return o("MAWDbMsg").toMsgId(e.message.messageId)}).filter(Boolean);E=yield n("cr:19816").forwardMessageBatch(t,f,k,d,c)}else E=yield n("cr:19816").forwardMessage(t,f,L,d,c,_!=null?o("MAWVault").vault(_):void 0).then(function(e){return[e]});return n("cr:9759")!=null&&v!=null&&(yield n("cr:9759")(t,v,S,o("LSMessagingThreadTypeUtil").isOneToOne(v.threadType))),E!=null?E:[o("WAResultOrError").makeResult({description:"removal pending rollout of MAWMessageSendReporterV2",messageType:"fixMe"})]}throw r("FBLogger")("messenger_web_sharing").mustfixThrow("We won't reach to this step, if you are in QE, you should use secure forward")}catch(e){var I=r("getErrorSafe")(e);throw o("sendToSentQPLLogger").markSendToSentFail(c,"failed_forwarding_message",I),r("FBLogger")("messenger_web").catching(I).mustfix("MW Fail forwarding a message"),I}});return function(e,t,n,r,o,i,l,s,u){return a.apply(this,arguments)}})(),[t])}var g=n("$InternalEnum")({SecureToOpen:"secure_to_open",OpenToOpen:"open_to_open",SecureToSecure:"secure_to_secure",OpenToSecure:"open_to_secure"});function h(t,a,i,l){var c,h=(s||(s=r("useReStore")))(),y=_(h,t,i),C=r("useIsSecureMessage")(h,t,{fallbackThreadType:a}),b=o("MWPActor.react").useActor(),v=!(d||(d=o("I64"))).equal(b,t.senderId),S=o("MWLSForwardMessage").useForwardMessage(),R=o("MWLSForwardMessage").useForwardAttachment(),L=r("useGetForwardSource")(),E=o("MWChatMessageId").makeSent(d.to_string(t.threadKey),t.messageId,d.to_string(t.timestampMs)),k=o("CometRelay").useRelayEnvironment(),I=f(),T=o("MWSharedMsgLogUtils").getMessageTypeFromDisplayedContentType(t.displayedContentTypes),D=y.length>0?o("MWMediaRenderQplUtils").deriveMessageContentTypeStringFromAttachmentTypeLessAccurate(y[0].attachmentType):"NO_ATTACHMENT",x=m(function(){var e,n;return new Set((e=(n=t.mentionIds)==null||n.split==null?void 0:n.split(","))!=null?e:[])},[t.mentionIds]),$=x.size>0,P=o("MWUnvaultedText").useMWUnvaultedText(!1,t.text),N=(c=o("useStringWithSubstitutions").useStringWithMentionSubstitutionsAndUpdatedRanges(C?P:null,[],x,t.threadKey))!=null?c:{textWithSubstitutions:P},M=N.textWithSubstitutions,w=o("Int64Hooks").useCallbackInt64((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=o("MWChatThreadId").toThreadKey(e),r=yield o("MAWThreadId").getThread(h.tables,n),a=function(r){return I(t,y,b,v,e,r,L,l,$?M:void 0)},i=o("sendToSentQPLLogger").markSendToSentStartWithAnnotation(r,{isForward:!0,mediaGroupInfo:l,numberOfAttachments:y.length},(u||(u=o("LSIntEnum"))).unwrapIntEnum(L),{string:{attachment_type:"forward",message_content_type_from_attachment:D,message_type:T}});yield a(i)});return function(t){return e.apply(this,arguments)}})(),[h.tables,l,y,L,D,T,I,t,b,v,$,M]),A=o("Int64Hooks").useCallbackInt64((function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var l=o("MWChatThreadId").toThreadKey(a),s=o("MWChatThreadId").getMessagingThreadType(a),c=yield(e||(e=n("Promise"))).all([o("MAWThreadId").isSecureThreadKey(h.tables,l),o("MAWThreadId").getThread(h.tables,l),p(h,l,b),o("MAWVerifyThreadCutover").verifyThreadCutover(e.resolve(h),l),o("MAWThreadId").getThread(h.tables,l)]),d=c[0],m=c[1],_=c[2],f=c[3],C=c[4],I=d||f,x=function(t,n){n===void 0&&(n=0);var e=o("sendToSentQPLLogger").markSendToSentStart();if(C!=null){var a=o("MWSharedS2SBaseAnnotations").getMessageTypeParams({isForward:!0,numberOfAttachments:n,threadType:C.threadType});r("promiseDone")(o("MWSharedMsgLogUtils").getSendToSentAnnotations({attachmentTypeParams:a,messageOfflineThreadingId:t,source:(u||(u=o("LSIntEnum"))).unwrapIntEnum(L),thread:C}),function(t){t.string=babelHelpers.extends({},t.string,{attachment_type:"forward",message_content_type_from_attachment:D,message_type:T}),o("sendToSentQPLLogger").addSendToSentAnnotations(e,t)})}return o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{forward_type:g.OpenToSecure,message_content_type_from_attachment:D,message_type:T}}),e};if(n("cr:19894")!=null&&I){var $=function(r,o){return(function(e){return n("cr:19894").forwardMessage(k,h,l,t,v,o,L,e!=null?e:void 0,r).then(function(e){return[e]})})};if(y.length===0){var P=o("MAWExternalId").generateExternalId(),N=x(P);yield $(P,void 0)(N),o("sendToSentQPLLogger").markSendToSentSuccess(N)}else yield(e||(e=n("Promise"))).all(y.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("MAWExternalId").generateExternalId(),n=x(t,1);try{yield $(t,e)(n),o("sendToSentQPLLogger").markSendToSentSuccess(n)}catch(e){var a=r("getErrorSafe")(e);throw o("sendToSentQPLLogger").markSendToSentFail(n,"failed_forwarding_message",a),r("FBLogger")("messenger_web").catching(a).mustfix("MW Fail forwarding a message"),a}});return function(t){return e.apply(this,arguments)}})()));n("cr:9759")!=null&&m!=null&&n("cr:9759")(h,m,_,o("LSMessagingThreadTypeUtil").isOneToOne(m.threadType))}else if(!I){var M=x(void 0,y.length);try{o("sendToSentQPLLogger").addSendToSentAnnotations(M,{string:{forward_type:g.OpenToOpen,message_content_type_from_attachment:D,message_type:T}}),i==null?S(l,s,E):R(a,i),o("sendToSentQPLLogger").markSendToSentSuccess(M);return}catch(e){var w=r("getErrorSafe")(e);throw o("sendToSentQPLLogger").markSendToSentFail(M,"failed_forwarding_message",w),r("FBLogger")("messenger_web").catching(w).mustfix("MW Fail forwarding a message"),w}}});return function(e){return a.apply(this,arguments)}})(),[h,b,D,T,y,L,k,t,v,i,S,E,R]);return o("Int64Hooks").useMemoInt64(function(){return C?w:A},[C,w,A])}l.ForwardType=g,l.useMWV2ForwardMessage=h}),98);
__d("forwardXMA",["I64","IGDInstamadilloUtils","asyncToGeneratorRuntime","forwardText","forwardXMAFromInstamadillo","forwardXMAFromOpenToInstamadillo","forwardXMAOpenToOpen","forwardXMAUtils","requireDeferred","sendToSentQPLLogger","useMWV2ForwardMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardXMA");function u(e,t,n,r,o,a,i,l){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,u,c,d){var m,p=n.defaultCtaId;if(p!=null){var _=yield s.load(),f=yield _(),g=yield f.tables.attachment_ctas.get(p),h=(m=n.headerTitle)!=null?m:n.titleText,y=g==null?void 0:g.actionUrl,C=g==null?void 0:g.targetId;if(y!=null){var b=yield f.tables.threads.get((e||(e=o("I64"))).of_string(c.id)),v=o("forwardXMAUtils").shouldForwardXMAViaTTLC(b,t,n,g),S=c.isInstamadilloCutover||c.isDisappearingModeSettingOn||v,R=o("IGDInstamadilloUtils").isInstamadilloMessage(t)?S?o("useMWV2ForwardMessage").ForwardType.SecureToSecure:o("useMWV2ForwardMessage").ForwardType.SecureToOpen:S?o("useMWV2ForwardMessage").ForwardType.OpenToSecure:o("useMWV2ForwardMessage").ForwardType.OpenToOpen;switch(o("sendToSentQPLLogger").addSendToSentAnnotations(d,{bool:{use_instamadillo_transport:S,use_open_eb:v}}),R){case o("useMWV2ForwardMessage").ForwardType.OpenToSecure:return r("forwardXMAFromOpenToInstamadillo")(c,n,C,h,y,v);case o("useMWV2ForwardMessage").ForwardType.SecureToSecure:return r("forwardXMAFromInstamadillo")(c,t.xmaReceiverFetchParams,h,y);case o("useMWV2ForwardMessage").ForwardType.SecureToOpen:return r("forwardText")(y,a,i,l,u);case o("useMWV2ForwardMessage").ForwardType.OpenToOpen:return r("forwardXMAOpenToOpen")(t.messageId,a,i,l,u,(e||(e=o("I64"))).to_string(t.threadKey),(e||(e=o("I64"))).to_string(t.timestampMs))}}}}),c.apply(this,arguments)}l.default=u}),98);
__d("sendIGDOptimisticRichContentMessage",["fbt","EntMessageReplyType","I64","LSAuthorityLevel","LSIntEnum","LSMessageHiddenState","LSMessageRenderingType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSMessageSendStatus","LSQuickReplyType","LSReplyMessageStatus","MNLSXMALayoutType","MNLSXMATemplateType","PolarisDirectStrings","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(e,t,n,r,o,a,i,l,s,u,c,m,p,_,f,g){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,l,c,d,m,p,_,f,g,h,y,C,b,v,S){C===void 0&&(C=!0);var R={authorityLevel:(e||(e=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC),displayedContentTypes:d,hasQuickReplies:!1,isAdminMessage:!1,isCollapsed:!1,isExpired:!1,isUnsent:!1,messageHiddenState:e.ofNumber(r("LSMessageHiddenState").NOT_HIDDEN),messageId:c,messageRenderingType:e.ofNumber(r("LSMessageRenderingType").DEFAULT),offlineThreadingId:c,primarySortKey:p,quickReplyType:e.ofNumber(r("LSQuickReplyType").NONE),replyMessageHiddenState:e.ofNumber(r("LSMessageHiddenState").NOT_HIDDEN),senderId:m,sendStatus:e.ofNumber(r("LSMessageSendStatus").SENDING_TO_SERVER),sendStatusV2:e.ofNumber(1),textHasLinks:!1,threadKey:_,timestampMs:p,transportKey:"FBBroker",viewFlags:e.ofNumber(0)};if(y!=null){var L=yield t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n,r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.messages.index("messageId")).getKeyRange(y.messageId)),a=r!=null?yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.contacts).getKeyRange(r==null?void 0:r.senderId)):null;return{recipientName:a!=null&&(u||(u=o("I64"))).equal(a==null?void 0:a.id,m)?"yourself":a==null?void 0:a.name,replyMessageText:(n=r==null?void 0:r.text)!=null?n:""}});return function(t){return e.apply(this,arguments)}})(),"readonly",void 0,void 0,i.id+":93"),E=L.recipientName,k=L.replyMessageText;R=babelHelpers.extends({},R,{replyMessageText:k,replySnippet:E!=null?o("PolarisDirectStrings").youRepliedToUser(E).toString():s._(/*BTDS*/"You replied to Instagram User").toString(),replySourceId:y.messageId,replySourceType:(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessageReplySourceType").MESSAGE),replySourceTypeV2:e.ofNumber(r("LSMessageReplySourceTypeV2").MESSAGE),replyStatus:e.ofNumber(r("LSReplyMessageStatus").VALID),replyToUserId:_,replyType:e.ofNumber(r("EntMessageReplyType").REGULAR)})}else if(S!=null){var I,T,D,x;R=babelHelpers.extends({},R,{replyMessageText:(I=(T=S.message.content)==null?void 0:T.text_body)!=null?I:"",replySnippet:((D=S.sender)==null?void 0:D.username)!=null?o("PolarisDirectStrings").youRepliedToUser((x=S.sender)==null?void 0:x.username).toString():s._(/*BTDS*/"You replied to Instagram User").toString(),replySourceId:S.message.message_id,replySourceType:(e||(e=o("LSIntEnum"))).ofNumber(r("LSMessageReplySourceType").MESSAGE),replySourceTypeV2:e.ofNumber(r("LSMessageReplySourceTypeV2").MESSAGE),replyStatus:e.ofNumber(r("LSReplyMessageStatus").VALID),replyToUserId:_,replyType:e.ofNumber(r("EntMessageReplyType").REGULAR)})}var $={attachmentFbid:c,attachmentIndex:(u||(u=o("I64"))).zero,attachmentType:e.ofNumber(f),authorityLevel:e.ofNumber(r("LSAuthorityLevel").OPTIMISTIC),hasMedia:!1,hasXma:!1,imageUrl:g,isSharable:!1,messageId:c,playableUrl:g,previewHeight:a,previewUrl:g,previewUrlFallback:g,previewWidth:l,threadKey:_,timestampMs:p,transportKey:"FBBroker"},P=babelHelpers.extends({},$);switch(h){case"cutout_sticker":P=babelHelpers.extends({},$,{hasXma:!0,stickerType:"cutout_sticker",xmaLayoutType:(e||(e=o("LSIntEnum"))).ofNumber(r("MNLSXMALayoutType").SINGLE),xmasTemplateType:(e||(e=o("LSIntEnum"))).ofNumber(r("MNLSXMATemplateType").GENERIC_SHARE)});break;case"first_party_sticker":P=babelHelpers.extends({},$,{hasMedia:!0});break;case"avatar_sticker":P=babelHelpers.extends({},$,{hasXma:!0,stickerType:"avatar_sticker",xmaLayoutType:(e||(e=o("LSIntEnum"))).ofNumber(r("MNLSXMALayoutType").SINGLE),xmasTemplateType:(e||(e=o("LSIntEnum"))).ofNumber(r("MNLSXMATemplateType").GENERIC_SHARE)});break;case"third_party":P=babelHelpers.extends({},$,{hasMedia:!1,playableUrlMimeType:C?"image/gif":"image/jpeg"});break;case"music_sticker":P=babelHelpers.extends({},$,{hasXma:!0,stickerType:"music_sticker",subtitleText:v,titleText:b,xmaLayoutType:(e||(e=o("LSIntEnum"))).ofNumber(r("MNLSXMALayoutType").SINGLE),xmasTemplateType:(e||(e=o("LSIntEnum"))).ofNumber(r("MNLSXMATemplateType").GENERIC_SHARE)})}return t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield e.messages.put(R),yield e.attachments.put(P)});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":225")}),d.apply(this,arguments)}l.default=c}),226);
__d("useIGDForwardMessage",["FBLogger","I64","IGDThreadTTLCUtils","LSBitFlag","LSIntEnum","MWPActor.react","MWSharedS2SBaseAnnotations","MercuryLocalIDs","MessagingAttachmentType","PolarisDirectAPI","PolarisDirectConstants","ReQL","asyncToGeneratorRuntime","forwardAttachment","forwardAttachmentCollectionToOpen","forwardAttachmentToOpen","forwardText","forwardXMA","getErrorSafe","qex","react-compiler-runtime","sendIGDOptimisticRichContentMessage","sendToSentQPLLogger","useAsyncReStore","useGetForwardSource"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("qex")._("41")===!0;function c(e,t,n,r,o,a){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,c){var d=a.candidate,m=a.type,p=d.id,_=m==="thread"?2:1,f=yield t.tables.threads.get((e||(e=o("I64"))).of_string(p)),g=d.isInstamadilloCutover||d.isDisappearingModeSettingOn;if(o("LSBitFlag").has((s||(s=o("LSIntEnum"))).ofNumber(1),n.displayedContentTypes)){var h=o("IGDThreadTTLCUtils").isInstamadilloTTLCTextEnabled(f),y=g||h;return o("sendToSentQPLLogger").addSendToSentAnnotations(c,{bool:{use_instamadillo_transport:y,use_open_eb:h}}),r("forwardText")(n.text,d.id,_,i,l,{useInstamadilloTransport:y,useOpenEb:h})}var C=o("ReQL").fromTableDescending(t.tables.attachments).getKeyRange(n.threadKey,n.messageId),b=yield o("ReQL").toArrayAsync(C);if(b.length>1&&u)return r("forwardAttachmentCollectionToOpen")(n,p,_,i,l);if(b.length>0){var v=b[0],S=(s||(s=o("LSIntEnum"))).unwrapIntEnum(v.attachmentType);if(S===r("MessagingAttachmentType").XMA)if(v.stickerType==="cutout_sticker"||v.stickerType==="music_sticker"){var R,L,E,k=yield t.tables.ig_thread_info.get((e||(e=o("I64"))).of_string(p)),I=k==null?void 0:k.igThreadId,T=n.threadKey,D=yield t.tables.ig_thread_info.get(T),x=D==null?void 0:D.igThreadId;if(I==null||x==null)throw r("FBLogger")("igd_web").mustfixThrow("Failed to forward the cutout sticker");var $=o("MercuryLocalIDs").generateOfflineThreadingID(),P=e.of_float(Date.now()),N=1032,M=v.stickerType==="music_sticker"?"music_sticker":"cutout_sticker",w=v.stickerType==="music_sticker"?v.titleText:"",A=v.stickerType==="music_sticker"?v.subtitleText:"";return yield r("sendIGDOptimisticRichContentMessage")(t,(R=v.previewHeight)!=null?R:(e||(e=o("I64"))).zero,(L=v.previewWidth)!=null?L:(e||(e=o("I64"))).zero,$,e.of_int32(N),i,P,e.of_string(p),r("MessagingAttachmentType").XMA,(E=v.previewUrl)!=null?E:"",M,null,!1,w,A,null),o("PolarisDirectAPI").broadcastForward(I,o("PolarisDirectConstants").ThreadItemType.GENERIC_XMA,n.messageId,x,$)}else return r("forwardXMA")(n,v,d.id,_,i,l,d,c);else{if(S===r("MessagingAttachmentType").ANIMATED_IMAGE)return r("forwardAttachmentToOpen")(v.attachmentFbid,d.id,_,i,l);var F=!1;S===r("MessagingAttachmentType").IMAGE?F=o("IGDThreadTTLCUtils").isInstamadilloTTLCImageEnabled(f):S===r("MessagingAttachmentType").VIDEO?F=o("IGDThreadTTLCUtils").isInstamadilloTTLCVideoEnabled(f):S===r("MessagingAttachmentType").AUDIO&&(F=o("IGDThreadTTLCUtils").isInstamadilloTTLCAudioEnabled(f));var O=g||F;return o("sendToSentQPLLogger").addSendToSentAnnotations(c,{bool:{use_instamadillo_transport:O,use_open_eb:F}}),r("forwardAttachment")(v,d.id,_,i,l,{useInstamadilloTransport:O,useOpenEb:F})}}}),d.apply(this,arguments)}function m(e){var t=o("react-compiler-runtime").c(5),a=r("useAsyncReStore")(),i=r("useGetForwardSource")(),l=o("MWPActor.react").useActor(),s;return t[0]!==a||t[1]!==e||t[2]!==l||t[3]!==i?(s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=o("sendToSentQPLLogger").markSendToSentStart(),s=yield p(yield a,e);o("sendToSentQPLLogger").addSendToSentAnnotations(n,s);try{yield c(yield a,e,t,l,i,n),o("sendToSentQPLLogger").markSendToSentSuccess(n)}catch(e){var u=e,d=r("getErrorSafe")(u);o("sendToSentQPLLogger").markSendToSentFail(n,"message_send_fail",d),r("FBLogger")("igd_web").catching(d).mustfix("IGD failure forwarding a message")}});return function(n){return t.apply(this,arguments)}})(),t[0]=a,t[1]=e,t[2]=l,t[3]=i,t[4]=s):s=t[4],s}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.tables.attachments).getKeyRange(n.threadKey,n.messageId)),i=a!=null?Object.keys(r("MessagingAttachmentType")).find(function(e){return r("MessagingAttachmentType")[e]===(s||(s=o("LSIntEnum"))).unwrapIntEnum(a.attachmentType)}):null,l=(e||(e=o("I64"))).equal(n.displayedContentTypes,(s||(s=o("LSIntEnum"))).ofNumber(1))?o("MWSharedS2SBaseAnnotations").MsgType.Text:o("MWSharedS2SBaseAnnotations").MsgType.NonText;return{bool:{is_forward_message:!0},string:{attachment_type:i,message_type:l}}}),_.apply(this,arguments)}l.default=m}),98);
__d("useIGDMessageMsysForward",["fbt","I64","IGDContactSearchDialogType.flow","IGDInstamadilloUtils","IGDSDialogPlaceholder.react","IGDThreadListNewMessageLoggingDataContext","JSResourceForInteraction","LSBitFlag","LSContactBitOffset","LSContactBlockedByViewerStatus","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MNLSXMALayoutType","MWLSThread","MWPActor.react","MWV2MessageRowIsRowFocusedContext.react","MessagingAttachmentType","MessengerWebUXLogger","ReQL","ReQLSuspense","asyncToGeneratorRuntime","gkx","qex","react","react-compiler-runtime","useIGDForwardMessage","useIGDMessageAttachment","useIGDSLazyDialog","useIsReadOnlyFeatureLimited","useIsThreadBlocked","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d,m=d||(d=o("react")),p=function(){return r("qex")._("121")===!0},_=r("qex")._("41")===!0,f=r("gkx")("16543");function g(t,a,l){var d=o("react-compiler-runtime").c(17),m=(e||(e=r("useReStore")))(),g=o("MWPActor.react").useActor(),b=t.displayedContentTypes,v=t.senderId,S=t.threadKey,R=r("useIsReadOnlyFeatureLimited")(),L=r("useIsThreadBlocked")(),E=o("MWLSThread").useThreadExn(t.threadKey),k=E.threadType,I;d[0]!==m.tables.contacts||d[1]!==v?(I=function(){return o("ReQL").fromTableAscending(m.tables.contacts).getKeyRange(v)},d[0]=m.tables.contacts,d[1]=v,d[2]=I):I=d[2];var T;d[3]!==m||d[4]!==v?(T=[m,v],d[3]=m,d[4]=v,d[5]=T):T=d[5];var D=o("ReQLSuspense").useFirst(I,T,i.id+":72"),x=D!=null&&o("LSContactBitOffset").has(66,D),$=o("LSThreadBitOffset").has(103,E),P=o("LSMessagingThreadTypeUtil").isIGDMessageRequest(E),N=(u||(u=o("I64"))).equal(t.displayedContentTypes,(c||(c=o("LSIntEnum"))).ofNumber(256)),M=u.equal(v,g),w=!M&&o("LSMessagingThreadTypeUtil").isOneToOne(k)&&D!=null?!(u||(u=o("I64"))).equal(D.blockedByViewerStatus,(c||(c=o("LSIntEnum"))).ofNumber(r("LSContactBlockedByViewerStatus").UNBLOCKED)):!1,A=r("useIGDMessageAttachment")(m,t,S),F=A.attachment,O=A.hasMultipleAttachments,B=A.isVideoStack,W=F!=null&&((u||(u=o("I64"))).equal(F.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").EPHEMERAL_IMAGE))||(u||(u=o("I64"))).equal(F.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").EPHEMERAL_VIDEO))),q=F!=null&&(u||(u=o("I64"))).equal(F.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO)),U=F!=null&&(u||(u=o("I64"))).equal(F.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").STICKER)),V=F!=null&&(u||(u=o("I64"))).equal(F.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA))?F.xmaLayoutType!=null&&!((u||(u=o("I64"))).equal(F.xmaLayoutType,(c||(c=o("LSIntEnum"))).ofNumber(r("MNLSXMALayoutType").PLACEHOLDER))||(u||(u=o("I64"))).equal(F.xmaLayoutType,(c||(c=o("LSIntEnum"))).ofNumber(r("MNLSXMALayoutType").EXPIRED_PLACEHOLDER))):!0,H=F!=null&&(u||(u=o("I64"))).equal(F.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA))&&F.stickerType==="ai_generated_sticker",G=(u||(u=o("I64"))).equal(b,o("LSBitFlag").empty)&&!W,z=r("useIGDForwardMessage")(t),j=r("MessengerWebUXLogger").useInteractionLogger(),K=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),Q=o("MWV2MessageRowIsRowFocusedContext.react").useMWV2MessageRowIsRowFocusedContext(),X=Q.setIsDialogOpened,Y;d[6]===Symbol.for("react.memo_cache_sentinel")?(Y=r("JSResourceForInteraction")("IGDAWOminipickerDialog.react").__setRef("useIGDMessageMsysForward"),d[6]=Y):Y=d[6];var J=r("useIGDSLazyDialog")(Y,C),Z=J[0],ee=o("IGDInstamadilloUtils").isInstamadilloMessage(t)&&t.ephemeralDurationInSec!=null&&(u||(u=o("I64"))).gt(t.ephemeralDurationInSec,(u||(u=o("I64"))).zero),te=!l&&!L&&!x&&!P&&!R&&!t.isUnsent&&!G&&(o("LSMessagingThreadTypeUtil").isArmadilloSecure(k)?p():!0)&&$&&V&&!w&&!N&&!W&&!q&&!ee&&(!O||_)&&(!B||f)&&!U&&!H;if(!te)return null;var ne;d[7]!==z?(ne=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){Array.from(e.values()).map(function(e){return z(e)})});return function(n){return e.apply(this,arguments)}})(),d[7]=z,d[8]=ne):ne=d[8];var re=ne,oe;d[9]!==K||d[10]!==O||d[11]!==j||d[12]!==a||d[13]!==re||d[14]!==X||d[15]!==Z?(oe=function(){j==null||j({eventName:"message_forward",extraData:{},flowInstanceId:K}),O&&_&&(j==null||j({eventName:"media_collection_message_forward"})),Z({includeGroup:!0,loggingEventName:"forward_thread_attempt",maxRecipients:5,onSubmit:re,searchType:o("IGDContactSearchDialogType.flow").IGDContactSearchDialogType.FORWARD_MESSAGE,submitButtonLabel:s._(/*BTDS*/"Send").toString(),titleLabel:s._(/*BTDS*/"Forward").toString()},function(){a(),X(y)}),X(h)},d[9]=K,d[10]=O,d[11]=j,d[12]=a,d[13]=re,d[14]=X,d[15]=Z,d[16]=oe):oe=d[16];var ae=oe;return ae}function h(){return!0}function y(){return!1}function C(e){return m.jsx(r("IGDSDialogPlaceholder.react"),{fixedHeight:!0,onClose:e,size:"large"})}C.displayName=C.name+" [from "+i.id+"]",l.default=g}),226);
__d("useIGDMessageForwardMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSMessagesOutlineIcon.react","react","react-compiler-runtime","useIGDMessageMsysForward"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(e,t,n){var a=o("react-compiler-runtime").c(4),i=r("useIGDMessageMsysForward")(e,t,n);if(i==null)return null;var l;a[0]===Symbol.for("react.memo_cache_sentinel")?(l=s._(/*BTDS*/"Forward"),a[0]=l):l=a[0];var c=l,d;a[1]===Symbol.for("react.memo_cache_sentinel")?(d=u.jsx(r("IGDSMessagesOutlineIcon.react"),{alt:c,size:18}),a[1]=d):d=a[1];var m;return a[2]!==i?(m=u.jsx(r("IGDMessageContextMenuItem.react"),{icon:d,label:c,onClick:i,testid:void 0}),a[2]=i,a[3]=m):m=a[3],m}l.default=c}),226);
__d("useIGDMessageInspectMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSDialogPlaceholder.react","IGDSSearchPanoOutlineIcon.react","JSResourceForInteraction","MWV2MessageRowIsRowFocusedContext.react","gkx","react","react-compiler-runtime","useIGDSLazyDialog"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e.useCallback,d={dialog:{height:"xrqonrr",width:"x1m7g9aj",$$css:!0}};function m(e){var t=o("react-compiler-runtime").c(9),n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=s._(/*BTDS*/"[Internal] Inspect"),t[0]=n):n=t[0];var a=n,i=o("MWV2MessageRowIsRowFocusedContext.react").useMWV2MessageRowIsRowFocusedContext(),l=i.setIsDialogOpened,c;t[1]===Symbol.for("react.memo_cache_sentinel")?(c=r("JSResourceForInteraction")("IGDMessageInspectMessageDialog.react").__setRef("useIGDMessageInspectMenuItem.react"),t[1]=c):c=t[1];var d=r("useIGDSLazyDialog")(c,f),m=d[0],g;t[2]!==e||t[3]!==l||t[4]!==m?(g=function(){m({message:e},function(){l(_)}),l(p)},t[2]=e,t[3]=l,t[4]=m,t[5]=g):g=t[5];var h=g,y=r("gkx")("24015");if(!y)return null;var C;t[6]===Symbol.for("react.memo_cache_sentinel")?(C=u.jsx(r("IGDSSearchPanoOutlineIcon.react"),{alt:a,size:18}),t[6]=C):C=t[6];var b;return t[7]!==h?(b=u.jsx(r("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:C,label:a,onClick:h,testid:void 0}),t[7]=h,t[8]=b):b=t[8],b}function p(){return!0}function _(){return!1}function f(e){return u.jsx(r("IGDSDialogPlaceholder.react"),{innerContentXStyle:d.dialog,onClose:e})}f.displayName=f.name+" [from "+i.id+"]",l.default=m}),226);
__d("useIGDMessageNegativeFeedbackMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSDialogPlaceholder.react","IGDSThumbDownPanoOutline24Icon.react","JSResourceForInteraction","emptyFunction","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDIsGenAiReelsPlugin","useIGDSLazyDialog","useIGDSToaster","useMWV2SubmitFeedbackAction"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e.useCallback;function d(e,t){var n=o("react-compiler-runtime").c(11),a=r("useIGDSToaster")(),i;n[0]!==a?(i=function(){a.add({message:s._(/*BTDS*/"Feedback has been submitted"),target:"bottom-left"})},n[0]=a,n[1]=i):i=n[1];var l=i,c=r("useMWV2SubmitFeedbackAction")(e.botResponseId,l),d;n[2]===Symbol.for("react.memo_cache_sentinel")?(d=r("JSResourceForInteraction")("MWV2SubmitNegativeFeedbackDialog.react").__setRef("useIGDMessageNegativeFeedbackMenuItem.react"),n[2]=d):d=n[2];var p=r("useIGDSLazyDialog")(d,m),_=p[0],f;n[3]!==e||n[4]!==c||n[5]!==_?(f=function(){_({message:e,onSubmit:c},r("emptyFunction"))},n[3]=e,n[4]=c,n[5]=_,n[6]=f):f=n[6];var g=f,h=r("useGenAIFeedbackSubmissionStatus")(e.botResponseId),y=r("useIGDIsGenAiReelsPlugin")(e);if(h==null||y||t)return null;var C;n[7]===Symbol.for("react.memo_cache_sentinel")?(C=s._(/*BTDS*/"Bad response"),n[7]=C):C=n[7];var b=C,v;n[8]===Symbol.for("react.memo_cache_sentinel")?(v=u.jsx(r("IGDSThumbDownPanoOutline24Icon.react"),{alt:b,size:18}),n[8]=v):v=n[8];var S;return n[9]!==g?(S=u.jsx(r("IGDMessageContextMenuItem.react"),{icon:v,label:b,onClick:g}),n[9]=g,n[10]=S):S=n[10],S}function m(e){return u.jsx(r("IGDSDialogPlaceholder.react"),{fixedHeight:!0,onClose:e,size:"large"})}m.displayName=m.name+" [from "+i.id+"]",l.default=d}),226);
__d("useIGDMessagePositiveFeedbackMenuItem.react",["fbt","BotFeedbackKind","IGDMessageContextMenuItem.react","IGDSThumbUpPanoOutline24Icon.react","IGDThreadListNewMessageLoggingDataContext","MessengerWebUXLogger","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDIsGenAiReelsPlugin","useIGDSToaster","useMWV2SubmitFeedbackAction"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useMemo;function p(e,t,n){var a,i=o("react-compiler-runtime").c(16),l=r("useIGDSToaster")(),c;i[0]!==l?(c=function(){l.add({message:s._(/*BTDS*/"Feedback has been submitted"),target:"bottom-left"})},i[0]=l,i[1]=c):c=i[1];var d=c,m=r("useMWV2SubmitFeedbackAction")(e.botResponseId,d),p=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),_=(a=e.botResponseId)!=null?a:"",f;i[2]!==_?(f={botResponseId:_},i[2]=_,i[3]=f):f=i[3];var g;i[4]!==p||i[5]!==f?(g={extraData:f,flowInstanceId:p},i[4]=p,i[5]=f,i[6]=g):g=i[6];var h=g,y=r("MessengerWebUXLogger").useInteractionLogger(),C;i[7]!==h||i[8]!==y||i[9]!==t||i[10]!==m?(C=function(){m(r("BotFeedbackKind").BOT_FEEDBACK_POSITIVE),y==null||y(babelHelpers.extends({eventName:"submit_positive_feedback"},h)),t()},i[7]=h,i[8]=y,i[9]=t,i[10]=m,i[11]=C):C=i[11];var b=C,v=r("useGenAIFeedbackSubmissionStatus")(e.botResponseId),S=r("useIGDIsGenAiReelsPlugin")(e);if(v==null||S||n)return null;var R;i[12]===Symbol.for("react.memo_cache_sentinel")?(R=s._(/*BTDS*/"Good response"),i[12]=R):R=i[12];var L=R,E;i[13]===Symbol.for("react.memo_cache_sentinel")?(E=u.jsx(r("IGDSThumbUpPanoOutline24Icon.react"),{alt:L,size:18}),i[13]=E):E=i[13];var k;return i[14]!==b?(k=u.jsx(r("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:E,label:L,onClick:b}),i[14]=b,i[15]=k):k=i[15],k}l.default=p}),226);
__d("useIGDMessageReaction.react",["fbt","EmojiFormat.bs","IGDThreadListNewMessageLoggingDataContext","Int64Hooks","MWLSThread","MWV2MessageReactionHooks","MessengerWebUXLogger","UnicodeUtils","asyncToGeneratorRuntime","emptyFunction","promiseDone","react","react-compiler-runtime","useAsyncReStore","useIGDGlobalReactMessage"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=(e||(e=o("react"))).useCallback;function d(e,t){var a,i=o("react-compiler-runtime").c(20),l=(a=o("MWV2MessageReactionHooks").MWV2MessageReactionHooks.useSelectedReaction(e.messageId,e.threadKey))==null?void 0:a.reaction,c=r("useIGDGlobalReactMessage")(e,"reaction_tray"),d;i[0]!==t||i[1]!==l||i[2]!==c?(d=function(n){var e=o("EmojiFormat.bs").codeArrayToUnicode(n);if(l!=null){var a=(u||(u=o("UnicodeUtils"))).getCodePoints(l);e===l&&(e=void 0),a[0]===10084&&n[0]===10084&&(e=void 0)}r("promiseDone")(c(e,"reaction")),t()},i[0]=t,i[1]=l,i[2]=c,i[3]=d):d=i[3];var m=d,p;i[4]!==m?(p={closeAfterSelect:!0,onClose:r("emptyFunction"),onSelect:m,showPopoverArrow:!1},i[4]=m,i[5]=p):p=i[5];var _=p,f;i[6]===Symbol.for("react.memo_cache_sentinel")?(f=s._(/*BTDS*/"React"),i[6]=f):f=i[6];var g=f,h=r("useAsyncReStore")(),y=r("MessengerWebUXLogger").useInteractionLogger(),C=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),b,v;i[7]!==h||i[8]!==C||i[9]!==y||i[10]!==e.messageId||i[11]!==e.threadKey?(b=function(a){r("promiseDone")(h.then((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("MWLSThread").getThreadAsync(t,e.threadKey);n&&(y==null||y({eventName:"reaction_open_emoji_picker",extraData:{message_id:e.messageId},flowInstanceId:C}))});return function(e){return t.apply(this,arguments)}})())),a()},v=[h,C,y,e.messageId,e.threadKey],i[7]=h,i[8]=C,i[9]=y,i[10]=e.messageId,i[11]=e.threadKey,i[12]=b,i[13]=v):(b=i[12],v=i[13]);var S=o("Int64Hooks").useCallbackInt64(b,v),R;i[14]!==l?(R=l!=null?(u||(u=o("UnicodeUtils"))).getCodePoints(l):null,i[14]=l,i[15]=R):R=i[15];var L;return i[16]!==S||i[17]!==_||i[18]!==R?(L=[g,S,_,R],i[16]=S,i[17]=_,i[18]=R,i[19]=L):L=i[19],L}l.default=d}),226);
__d("useIGDMessageReactionMenuItem.react",["I64","LSBitFlag","LSContactBitOffset","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWLSThread","ReQL","ReQLSuspense","cr:8247","cr:8257","gkx","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDMessageReaction.react","useIsGenAiFeedbackEnabled","useIsReadOnlyFeatureLimited","useIsThreadBlocked","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=u||(u=o("react"));function d(t,a,l){var u=o("react-compiler-runtime").c(15),d=(e||(e=r("useReStore")))(),m=t.displayedContentTypes,p=t.senderId,_=r("useIsThreadBlocked")(),f=o("MWLSThread").useThreadExn(t.threadKey),g=o("LSMessagingThreadTypeUtil").isIGDMessageRequest(f),h=r("useIsReadOnlyFeatureLimited")(),y;u[0]!==d.tables.contacts||u[1]!==p?(y=function(){return o("ReQL").fromTableAscending(d.tables.contacts).getKeyRange(p)},u[0]=d.tables.contacts,u[1]=p,u[2]=y):y=u[2];var C;u[3]!==d||u[4]!==p?(C=[d,p],u[3]=d,u[4]=p,u[5]=C):C=u[5];var b=o("ReQLSuspense").useFirst(y,C,i.id+":53"),v=o("LSThreadBitOffset").has(18,f),S=o("LSThreadBitOffset").has(139,f),R=o("LSThreadBitOffset").has(169,f),L=(s||(s=o("I64"))).equal(m,o("LSBitFlag").empty),E=b!=null&&o("LSContactBitOffset").has(66,b),k=r("useIsGenAiFeedbackEnabled")(t.botResponseId,r("gkx")("4253")===!0),I=r("useGenAIFeedbackSubmissionStatus")(t.botResponseId),T=!l&&!_&&!E&&!g&&!h&&!t.isUnsent&&!L&&(S?R:v)&&k&&I==null,D=r("useIGDMessageReaction.react")(t,a),x=D[0],$=D[1],P=D[2],N=D[3];if(!T)return null;var M;u[6]!==$?(M=function(t){return $(t)},u[6]=$,u[7]=M):M=u[7];var w;u[8]!==x||u[9]!==M?(w={align:"start",altLabel:x,label:x,onClickAction:M,useMenuItem:!0},u[8]=x,u[9]=M,u[10]=w):w=u[10];var A=w,F;return u[11]!==P||u[12]!==N||u[13]!==A?(F=n("cr:8257")?c.jsx(n("cr:8257"),babelHelpers.extends({},A,{onClose:P.onClose,onSelect:P.onSelect,selectedReaction:N})):n("cr:8247")?c.jsx(n("cr:8247"),babelHelpers.extends({},A,P)):null,u[11]=P,u[12]=N,u[13]=A,u[14]=F):F=u[14],F}l.default=d}),98);
__d("useIGDMessageReplyMenuItem.react",["I64","IGDInstamadilloUtils","IGDMessageContextMenuItem.react","IGDSReplyPanoOutline24Icon.react","LSBitFlag","LSContactBitOffset","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWLSThread","ReQL","ReQLSuspense","gkx","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDMessageReply.react","useIsGenAiFeedbackEnabled","useIsReadOnlyFeatureLimited","useIsThreadBlocked","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=u||(u=o("react"));function d(t,n,a){var l=o("react-compiler-runtime").c(12),u=(e||(e=r("useReStore")))(),d=t.displayedContentTypes,m=t.senderId,p=r("useIsThreadBlocked")(),_=o("MWLSThread").useThreadExn(t.threadKey),f=o("LSMessagingThreadTypeUtil").isIGDMessageRequest(_),g=r("useIsReadOnlyFeatureLimited")(),h;l[0]!==u.tables.contacts||l[1]!==m?(h=function(){return o("ReQL").fromTableAscending(u.tables.contacts).getKeyRange(m)},l[0]=u.tables.contacts,l[1]=m,l[2]=h):h=l[2];var y;l[3]!==u||l[4]!==m?(y=[u,m],l[3]=u,l[4]=m,l[5]=y):y=l[5];var C=o("ReQLSuspense").useFirst(h,y,i.id+":53"),b=o("LSThreadBitOffset").has(42,_),v=r("useIGDMessageReply.react")(t,_,n),S=v[0],R=v[1],L=r("useIsGenAiFeedbackEnabled")(t.botResponseId,r("gkx")("4253")===!0),E=r("useGenAIFeedbackSubmissionStatus")(t.botResponseId);if(!b||!L)return null;var k=(s||(s=o("I64"))).equal(d,o("LSBitFlag").empty),I=C!=null&&o("LSContactBitOffset").has(66,C),T=o("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(_),D=!a&&!p&&!I&&!f&&!g&&!t.isUnsent&&!k&&L&&E==null&&o("IGDInstamadilloUtils").shouldRenderMessageReply(t,T);if(!D)return null;var x;l[6]!==R?(x=c.jsx(r("IGDSReplyPanoOutline24Icon.react"),{alt:R,size:18}),l[6]=R,l[7]=x):x=l[7];var $;return l[8]!==R||l[9]!==S||l[10]!==x?($=c.jsx(r("IGDMessageContextMenuItem.react"),{icon:x,label:R,onClick:S}),l[8]=R,l[9]=S,l[10]=x,l[11]=$):$=l[11],$}l.default=d}),98);
__d("IGDMessageReportMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSReportPanoOutline24Icon.react","MWPActor.react","emptyFunction","promiseDone","react","react-compiler-runtime","requireDeferred","useIGDSLazyDialog","useReStore"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=u||(u=o("react")),d=u.useCallback,m=r("requireDeferred")("MWLogMessageAction").__setRef("IGDMessageReportMenuItem.react");function p(t){var n=o("react-compiler-runtime").c(13),a=t.dialogProps,i=t.dialogResource,l=t.message,u=o("MWPActor.react").useActor(),d=(e||(e=r("useReStore")))(),p;n[0]===Symbol.for("react.memo_cache_sentinel")?(p=s._(/*BTDS*/"Report"),n[0]=p):p=n[0];var _=p,f=r("useIGDSLazyDialog")(i),g=f[0],h;n[1]!==u||n[2]!==d||n[3]!==a||n[4]!==l.messageId||n[5]!==l.senderId||n[6]!==l.threadKey||n[7]!==g?(h=function(){g(a,r("emptyFunction")),m.onReady(function(e){return r("promiseDone")(e.log(d,l.messageId,l.threadKey,"message_dot_menu","report",void 0,void 0,void 0,l.senderId,void 0,u))})},n[1]=u,n[2]=d,n[3]=a,n[4]=l.messageId,n[5]=l.senderId,n[6]=l.threadKey,n[7]=g,n[8]=h):h=n[8];var y=h,C;n[9]===Symbol.for("react.memo_cache_sentinel")?(C=c.jsx(r("IGDSReportPanoOutline24Icon.react"),{alt:_,color:"ig-error-or-destructive",size:18}),n[9]=C):C=n[9];var b;n[10]===Symbol.for("react.memo_cache_sentinel")?(b={color:"errorOrDestructive"},n[10]=b):b=n[10];var v;return n[11]!==y?(v=c.jsx(r("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:C,label:_,labelProps:b,onClick:y,testid:void 0}),n[11]=y,n[12]=v):v=n[12],v}l.default=p}),226);
__d("useIGDMessageReportMenuItem.react",["I64","IGDMessageReportMenuItem.react","JSResourceForInteraction","LSContactBitOffset","LSIntEnum","LSMessagingThreadTypeUtil","MWPActor.react","ReQL","ReQLSuspense","emptyFunction","getLSMediaContactProfilePictureUrl","react","react-compiler-runtime","useMWBShouldReportThreadAsInstamadillo","usePolarisAnalyticsContext","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=s||(s=o("react")),m=[(u||(u=o("LSIntEnum"))).ofNumber(1),u.ofNumber(16384),u.ofNumber(2),u.ofNumber(4),(c||(c=o("I64"))).add(u.ofNumber(1),u.ofNumber(8192)),c.add(u.ofNumber(16384),u.ofNumber(8192)),c.add(u.ofNumber(2),u.ofNumber(8192)),c.add(u.ofNumber(4),u.ofNumber(8192))];function p(t,n){var a,l=o("react-compiler-runtime").c(61),s=(e||(e=r("useReStore")))(),u=o("MWPActor.react").useActor(),p=t.displayedContentTypes,_=t.senderId,f;l[0]!==s.tables.contacts||l[1]!==_?(f=function(){return o("ReQL").fromTableAscending(s.tables.contacts).getKeyRange(_)},l[0]=s.tables.contacts,l[1]=_,l[2]=f):f=l[2];var g;l[3]!==s||l[4]!==_?(g=[s,_],l[3]=s,l[4]=_,l[5]=g):g=l[5];var h=o("ReQLSuspense").useFirst(f,g,i.id+":65"),y=h!=null&&o("LSContactBitOffset").has(18,h),C=(c||(c=o("I64"))).equal(_,u),b;l[6]!==s.tables.contacts||l[7]!==t.senderId?(b=function(){return o("ReQL").fromTableAscending(s.tables.contacts).getKeyRange(t.senderId)},l[6]=s.tables.contacts,l[7]=t.senderId,l[8]=b):b=l[8];var v;l[9]!==s||l[10]!==t.senderId?(v=[s,t.senderId],l[9]=s,l[10]=t.senderId,l[11]=v):v=l[11];var S=o("ReQLSuspense").useFirst(b,v,i.id+":77"),R;l[12]!==s.tables.ig_thread_info||l[13]!==t.threadKey?(R=function(){return o("ReQL").fromTableAscending(s.tables.ig_thread_info).getKeyRange(t.threadKey)},l[12]=s.tables.ig_thread_info,l[13]=t.threadKey,l[14]=R):R=l[14];var L;l[15]!==s||l[16]!==t.threadKey?(L=[s,t.threadKey],l[15]=s,l[16]=t.threadKey,l[17]=L):L=l[17];var E=o("ReQLSuspense").useFirst(R,L,i.id+":82"),k;l[18]!==s.tables.threads||l[19]!==t.threadKey?(k=function(){return o("ReQL").fromTableAscending(s.tables.threads).getKeyRange(t.threadKey)},l[18]=s.tables.threads,l[19]=t.threadKey,l[20]=k):k=l[20];var I;l[21]!==s||l[22]!==t.threadKey?(I=[s,t.threadKey],l[21]=s,l[22]=t.threadKey,l[23]=I):I=l[23];var T=o("ReQLSuspense").useFirst(k,I,i.id+":90"),D;l[24]!==u||l[25]!==s.tables.mailbox_metadata?(D=function(){return o("ReQL").fromTableAscending(s.tables.mailbox_metadata).getKeyRange(u)},l[24]=u,l[25]=s.tables.mailbox_metadata,l[26]=D):D=l[26];var x;l[27]!==u||l[28]!==s?(x=[s,u],l[27]=u,l[28]=s,l[29]=x):x=l[29];var $=o("ReQLSuspense").useFirst(D,x,i.id+":95"),P=r("useMWBShouldReportThreadAsInstamadillo")(T),N=r("usePolarisAnalyticsContext")()+"WWW",M=y&&!C&&m.findIndex(function(e){return(c||(c=o("I64"))).equal(p,e)})!==-1;if(!M||S==null||$==null||E==null||T==null)return null;var w;l[30]!==n?(w=o("LSMessagingThreadTypeUtil").isGroup(n),l[30]=n,l[31]=w):w=l[31];var A;l[32]!==S?(A=r("getLSMediaContactProfilePictureUrl")(S),l[32]=S,l[33]=A):A=l[33];var F;l[34]!==t.senderId?(F=(c||(c=o("I64"))).to_string(t.senderId),l[34]=t.senderId,l[35]=F):F=l[35];var O=(a=S.secondaryName)!=null?a:"",B;l[36]!==P||l[37]!==w||l[38]!==A||l[39]!==F||l[40]!==O?(B={isGroup:w,onClose:r("emptyFunction"),profilePicUrl:A,senderId:F,shouldReportAsInstamadillo:P,username:O},l[36]=P,l[37]=w,l[38]=A,l[39]=F,l[40]=O,l[41]=B):B=l[41];var W=B,q;if(P){var U=t.messageId,V;l[42]!==t.threadKey?(V=(c||(c=o("I64"))).to_string(t.threadKey),l[42]=t.threadKey,l[43]=V):V=l[43];var H;l[44]!==t.messageId||l[45]!==W||l[46]!==V?(H=babelHelpers.extends({},W,{reportedObjectID:U,threadId:V}),l[44]=t.messageId,l[45]=W,l[46]=V,l[47]=H):H=l[47],q=H}else{var G=E.igThreadId,z;l[48]!==t.messageId?(z=btoa(t.messageId),l[48]=t.messageId,l[49]=z):z=l[49];var j=encodeURI(z),K;l[50]!==$.id?(K=(c||(c=o("I64"))).to_string($.id),l[50]=$.id,l[51]=K):K=l[51];var Q=G+"_"+j+"_"+K,X;l[52]!==N||l[53]!==W||l[54]!==Q||l[55]!==E.igThreadId?(X=babelHelpers.extends({},W,{containerModule:N,reportedObjectID:Q,threadId:E.igThreadId}),l[52]=N,l[53]=W,l[54]=Q,l[55]=E.igThreadId,l[56]=X):X=l[56],q=X}var Y=q,J;l[57]===Symbol.for("react.memo_cache_sentinel")?(J=r("JSResourceForInteraction")("PolarisDirectReportingMessageModal.react").__setRef("useIGDMessageReportMenuItem.react"),l[57]=J):J=l[57];var Z;return l[58]!==t||l[59]!==q?(Z=d.jsx(r("IGDMessageReportMenuItem.react"),{dialogProps:Y,dialogResource:J,message:t}),l[58]=t,l[59]=q,l[60]=Z):Z=l[60],Z}l.default=p}),98);
__d("useIGDMessageTimestampMenuItem.react",["IGDSBox.react","IGDSContextMenuItem.react","IGDSText.react","MWEditedEyebrowLabel.react","MWPDateBreak.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u={container:{paddingBottom:"x18d9i69",paddingInlineEnd:"xf159sx",paddingInlineStart:"xmzvs34",paddingTop:"xexx8yu",$$css:!0},containerWithDelimiter:{paddingBottom:"x10b6aqq",paddingInlineEnd:"xf159sx",paddingInlineStart:"xmzvs34",paddingTop:"xexx8yu",$$css:!0},editLabel:{marginTop:"xvijh9v",$$css:!0},separator:{paddingInlineEnd:"x14vy60q",paddingInlineStart:"x25sj25",$$css:!0}};function c(e,t,n){var a=o("react-compiler-runtime").c(15),i;a[0]!==e?(i=s.jsx(r("MWPDateBreak.react"),{renderTextWrapper:d,timestamp:e}),a[0]=e,a[1]=i):i=a[1];var l;a[2]!==t?(l=t&&s.jsx(r("IGDSBox.react"),{xstyle:u.editLabel,children:s.jsx(r("IGDSText.react"),{color:"secondaryText",size:"footnote",children:s.jsx(r("MWEditedEyebrowLabel.react"),{separatorStyle:u.separator})})}),a[2]=t,a[3]=l):l=a[3];var c;a[4]!==i||a[5]!==l?(c=s.jsxs(r("IGDSBox.react"),{alignItems:"center",direction:"row",children:[i,l]}),a[4]=i,a[5]=l,a[6]=c):c=a[6];var m=n?u.containerWithDelimiter:u.container,p;a[7]!==c||a[8]!==m?(p=s.jsx(o("IGDSContextMenuItem.react").IGDSContextMenuItem,{title:c,xstyle:m}),a[7]=c,a[8]=m,a[9]=p):p=a[9];var _;a[10]!==n?(_=n?s.jsx("div",{className:"x1y3jaa6 x28ko6u xdj266r x1w5wx5t x1e56ztr x1qfufaz"}):null,a[10]=n,a[11]=_):_=a[11];var f;return a[12]!==p||a[13]!==_?(f=s.jsxs(r("IGDSBox.react"),{children:[p,_]}),a[12]=p,a[13]=_,a[14]=f):f=a[14],f}function d(e){return s.jsx(r("IGDSText.react"),{color:"secondaryText",size:"footnote",weight:"semibold",children:e})}d.displayName=d.name+" [from "+i.id+"]",l.default=c}),98);
__d("useIGDMessageUnhideMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSInfoPanoOutlineIcon.react","IgdHideReportedMessageFalcoEvent","JSResourceForInteraction","MWV2MessageRowIsRowFocusedContext.react","react","react-compiler-runtime","useIGDSLazyDialog"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e.useCallback;function d(e,t){var n=o("react-compiler-runtime").c(9),a;n[0]===Symbol.for("react.memo_cache_sentinel")?(a=s._(/*BTDS*/"Why this is hidden"),n[0]=a):a=n[0];var i=a,l=o("MWV2MessageRowIsRowFocusedContext.react").useMWV2MessageRowIsRowFocusedContext(),c=l.setIsDialogOpened,d;n[1]===Symbol.for("react.memo_cache_sentinel")?(d=r("JSResourceForInteraction")("IGDMessageUnhideDialog.react").__setRef("useIGDMessageUnhideMenuItem.react"),n[1]=d):d=n[1];var f=r("useIGDSLazyDialog")(d),g=f[0],h;n[2]!==t||n[3]!==c||n[4]!==g?(h=function(){g({onUnhide:t},function(){c(_)}),c(p),r("IgdHideReportedMessageFalcoEvent").log(m)},n[2]=t,n[3]=c,n[4]=g,n[5]=h):h=n[5];var y=h;if(!e)return null;var C;n[6]===Symbol.for("react.memo_cache_sentinel")?(C=u.jsx(r("IGDSInfoPanoOutlineIcon.react"),{alt:i,size:18}),n[6]=C):C=n[6];var b;return n[7]!==y?(b=u.jsx(r("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:C,label:i,onClick:y}),n[7]=y,n[8]=b):b=n[8],b}function m(){return{event_name:"user_bottomsheet_press_more_info"}}function p(){return!0}function _(){return!1}l.default=d}),226);
__d("IGDSUndoCirclePanoOutline24Icon.react",["IGDSSVGIconBase.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(4),n,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("path",{d:"M12 .5C5.659.5.5 5.66.5 12S5.659 23.5 12 23.5c6.34 0 11.5-5.16 11.5-11.5S18.34.5 12 .5Zm0 21c-5.238 0-9.5-4.262-9.5-9.5S6.762 2.5 12 2.5s9.5 4.262 9.5 9.5-4.262 9.5-9.5 9.5Z"}),a=s.jsx("path",{d:"M14.5 10H9.414l1.293-1.293a1 1 0 1 0-1.414-1.414l-3 2.999a1 1 0 0 0 0 1.414l3 3.001a.997.997 0 0 0 1.414 0 1 1 0 0 0 0-1.414L9.415 12H14.5c.827 0 1.5.674 1.5 1.501 0 .395-.157.794-.431 1.096-.227.249-.508.403-.735.403L14 14.999a1 1 0 0 0-.001 2l.833.001h.002c.796 0 1.604-.386 2.215-1.059a3.625 3.625 0 0 0 .951-2.44C18 11.571 16.43 10 14.5 10Z"}),t[0]=n,t[1]=a):(n=t[0],a=t[1]);var i;return t[2]!==e?(i=s.jsxs(r("IGDSSVGIconBase.react"),babelHelpers.extends({},e,{viewBox:"0 0 24 24",children:[n,a]})),t[2]=e,t[3]=i):i=t[3],i}var c=s.memo(u);l.default=c}),98);
__d("useIGDMessageUnsendMenuItem.react",["fbt","I64","IGDMessageContextMenuItem.react","IGDSUndoCirclePanoOutline24Icon.react","IGDThreadListNewMessageLoggingDataContext","Int64Hooks","JSResourceForInteraction","MWPActor.react","MWPThreadCapabilitiesContext","MWV2MessageRowIsRowFocusedContext.react","MessengerWebUXLogger","PolarisDirectLogger","react","react-compiler-runtime","useIGDIsCannesThread.react","useIGDSLazyDialog"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=e||(e=o("react"));function d(e,t){var n=o("react-compiler-runtime").c(19),a=o("MWPActor.react").useActor(),i=e.senderId,l=(u||(u=o("I64"))).equal(i,a),d=r("MessengerWebUXLogger").useInteractionLogger(),_=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),f=o("MWV2MessageRowIsRowFocusedContext.react").useMWV2MessageRowIsRowFocusedContext(),g=f.setIsDialogOpened,h;n[0]===Symbol.for("react.memo_cache_sentinel")?(h=r("JSResourceForInteraction")("IGDMessageUnsendDialog.react").__setRef("useIGDMessageUnsendMenuItem.react"),n[0]=h):h=n[0];var y=r("useIGDSLazyDialog")(h),C=y[0],b;n[1]!==_||n[2]!==d||n[3]!==e||n[4]!==g||n[5]!==C?(b=function(){d==null||d({eventName:"message_unsend",extraData:{},flowInstanceId:_}),C({message:e},function(){g(p)}),g(m),o("PolarisDirectLogger").DirectLogger.logDirectEvent("DirectThread","direct_delete_message_attempt")},n[1]=_,n[2]=d,n[3]=e,n[4]=g,n[5]=C,n[6]=b):b=n[6];var v;n[7]!==_||n[8]!==d||n[9]!==e||n[10]!==g||n[11]!==C||n[12]!==t?(v=[_,d,e,g,C,t],n[7]=_,n[8]=d,n[9]=e,n[10]=g,n[11]=C,n[12]=t,n[13]=v):v=n[13];var S=o("Int64Hooks").useCallbackInt64(b,v),R=o("MWPThreadCapabilitiesContext").useMWPThreadCapabilitiesContext(),L=R.messageUnsendEnabled,E=r("useIGDIsCannesThread.react")(t.threadKey,t.threadType);if(!L||!l||E)return null;var k;n[14]===Symbol.for("react.memo_cache_sentinel")?(k=s._(/*BTDS*/"Unsend"),n[14]=k):k=n[14];var I=k,T;n[15]===Symbol.for("react.memo_cache_sentinel")?(T=c.jsx(r("IGDSUndoCirclePanoOutline24Icon.react"),{alt:I,color:"ig-error-or-destructive",size:18}),n[15]=T):T=n[15];var D;n[16]===Symbol.for("react.memo_cache_sentinel")?(D={color:"errorOrDestructive"},n[16]=D):D=n[16];var x;return n[17]!==S?(x=c.jsx(r("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:T,label:I,labelProps:D,onClick:S}),n[17]=S,n[18]=x):x=n[18],x}function m(){return!0}function p(){return!1}l.default=d}),226);
__d("useIGDPinnedMessageLimitReachedDialog.react",["IGDSDialogPlaceholder.react","JSResourceForInteraction","react","react-compiler-runtime","useIGDSLazyDialog"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useCallback;function c(){var e=o("react-compiler-runtime").c(3),t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=r("JSResourceForInteraction")("IGDPinnedMessageLimitReachedDialog.react").__setRef("useIGDPinnedMessageLimitReachedDialog.react"),e[0]=t):t=e[0];var n=r("useIGDSLazyDialog")(t,d),a=n[0],i;e[1]!==a?(i=function(t,n){a({onContinue:t},n)},e[1]=a,e[2]=i):i=e[2];var l=i;return l}function d(e){return s.jsx(r("IGDSDialogPlaceholder.react"),{fixedHeight:!0,fixedWidth:!0,onClose:e,size:"default"})}d.displayName=d.name+" [from "+i.id+"]",l.default=c}),98);
__d("IGDMessageContextMenu.react",["I64","IGDBroadcastChannelLoggingShapes","IGDSBox.react","IGDSPopover.react","IGDThreadListNewMessageLoggingDataContext","MWCMThreadTypes.react","MessengerWebUXLogger","WebUXLoggingSurfaceContextProvider","cr:21429","isMWEditedMessage","react","react-compiler-runtime","useIGDBroadcastChannelImpressionLoggerWithCheck","useIGDEditMessageMenuItem.react","useIGDMessageCopyMenuItem.react","useIGDMessageForwardMenuItem.react","useIGDMessageInspectMenuItem.react","useIGDMessageNegativeFeedbackMenuItem.react","useIGDMessagePositiveFeedbackMenuItem.react","useIGDMessageReactionMenuItem.react","useIGDMessageReplyMenuItem.react","useIGDMessageReportMenuItem.react","useIGDMessageTimestampMenuItem.react","useIGDMessageUnhideMenuItem.react","useIGDMessageUnsendMenuItem.react","useIGDPinnedMessageLimitReachedDialog.react"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e||(e=o("react")),c=e.useMemo,d={popover:{borderStartStartRadius:"x1rgw4pv",borderStartEndRadius:"x1vjm0to",borderEndEndRadius:"xnqoqkk",borderEndStartRadius:"x16lu3ki",marginBottom:"xu06os2",$$css:!0}};function m(e){var t=o("react-compiler-runtime").c(27),a=e.isMessageHidden,i=e.message,l=e.onClose,c=e.onMessageUnhide,m=e.thread,_=o("MWCMThreadTypes.react").isIGBroadcastChannelThread(m.threadSubtype),f=r("useIGDBroadcastChannelImpressionLoggerWithCheck")(i.threadKey,m.threadSubtype,o("IGDBroadcastChannelLoggingShapes").MESSAGE_OPTIONS_RENDERED_SHAPE),g=o("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),h;t[0]!==g?(h={eventName:"message_contextual_menu_rendered",flowInstanceId:g},t[0]=g,t[1]=h):h=t[1];var y=r("MessengerWebUXLogger").useImpressionLoggerRef(h),C=r("useIGDMessageReplyMenuItem.react")(i,l,a),b=r("useIGDMessageReactionMenuItem.react")(i,l,a),v=r("useIGDEditMessageMenuItem.react")(i,l,m),S=r("useIGDMessageCopyMenuItem.react")(i,l,m,a),R=r("useIGDMessageForwardMenuItem.react")(i,l,a),L=r("useIGDPinnedMessageLimitReachedDialog.react")(),E=n("cr:21429")(i,l,m,L,a),k=r("useIGDMessagePositiveFeedbackMenuItem.react")(i,l,a),I=r("useIGDMessageNegativeFeedbackMenuItem.react")(i,a),T;if(t[2]!==S||t[3]!==v||t[4]!==R||t[5]!==I||t[6]!==E||t[7]!==k||t[8]!==b||t[9]!==C){var D=[b,C,v,R,S,E,k,I];T=D.filter(Boolean),t[2]=S,t[3]=v,t[4]=R,t[5]=I,t[6]=E,t[7]=k,t[8]=b,t[9]=C,t[10]=T}else T=t[10];var x=T,$;t[11]!==i?($=r("isMWEditedMessage")(i),t[11]=i,t[12]=$):$=t[12];var P=$,N;t[13]!==i.timestampMs?(N=(s||(s=o("I64"))).to_float(i.timestampMs),t[13]=i.timestampMs,t[14]=N):N=t[14];var M=r("useIGDMessageTimestampMenuItem.react")(N,P,x.length>0),w=r("useIGDMessageUnsendMenuItem.react")(i,m),A=r("useIGDMessageReportMenuItem.react")(i,m.threadType),F=r("useIGDMessageInspectMenuItem.react")(i),O=r("useIGDMessageUnhideMenuItem.react")(a,c),B;t[15]!==x?(B=x.map(p),t[15]=x,t[16]=B):B=t[16];var W;t[17]!==F||t[18]!==A||t[19]!==B||t[20]!==M||t[21]!==O||t[22]!==w?(W=u.jsx(o("WebUXLoggingSurfaceContextProvider").WebUXSurfaceLoggingContext.Provider,{value:"thread_view_message_options",children:u.jsxs(r("IGDSBox.react"),{minWidth:180,padding:2,children:[M,B,w,A,F,O]})}),t[17]=F,t[18]=A,t[19]=B,t[20]=M,t[21]=O,t[22]=w,t[23]=W):W=t[23];var q=W,U=_?f:y,V;return t[24]!==q||t[25]!==U?(V=u.jsx(r("IGDSPopover.react"),{popoverContent:q,popoverXStyle:d.popover,ref:U}),t[24]=q,t[25]=U,t[26]=V):V=t[26],V}function p(e,t){return u.jsx(r("IGDSBox.react"),{children:e},"igd-message-menu-item-"+t)}p.displayName=p.name+" [from "+i.id+"]",l.default=m}),98);
__d("getSendProfileToInstamadilloRecipient",["fbt","FBLogger","I64","IGDDataclassTypes.flow","LSAuthorityLevel","LSMessageReplySourceTypeV2","LSMessageSendStatus","asyncToGeneratorRuntime","getErrorSafe","issueSendInstamadilloXMAReceiverFetch","renderInstamadilloOptimisticXmaReceiverFetch"],(function(t,n,r,o,a,i,l,s){"use strict";var e;function u(t,a,i,l,u){if(i==null)throw r("FBLogger")("igd_web").mustfix("getSendProfileToInstamadilloRecipient: missing profileUsername");var c={__typename:"XMSGIgReceiverFetchXmaProfileFetchParams",igid:t},d={__typename:"XMSGIgXmaContentRefDataclass",action_type:o("IGDDataclassTypes.flow").XmsgIgXmaActionType.Share,content_type:o("IGDDataclassTypes.flow").XmsgIgReceiverFetchContentType.Profile,fetch_params:c,owner_fbid:a,target_url:l,username:i},m={contentRef:JSON.stringify(d)},p={authorityLevel:(e||(e=o("I64"))).of_int32(r("LSAuthorityLevel").OPTIMISTIC),isForwarded:u,replySourceTypeV2:u===!0?(e||(e=o("I64"))).of_int32(r("LSMessageReplySourceTypeV2").FORWARD):void 0,sendStatus:e.of_int32(r("LSMessageSendStatus").SENDING_TO_SERVER),sendStatusV2:e.of_int32(1)},_={actionUrl:l,nativeUrl:l,type_:"xma_open_native"},f={authorityLevel:e.of_int32(r("LSAuthorityLevel").OPTIMISTIC),subtitleText:s._(/*BTDS*/"Profile").toString(),titleText:i};return(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,o,a,i){try{var l=yield r("renderInstamadilloOptimisticXmaReceiverFetch")(e,m,c,f,_,p);yield r("issueSendInstamadilloXMAReceiverFetch")({comment:o,isDisappearingModeSettingOn:t,offlineThreadingId:l,openEb:n,receiverFetchXma:JSON.stringify(m),threadKey:e}),a==null||a(e)}catch(t){var s=r("getErrorSafe")(t);i==null||i(s,e)}});return function(t,n,r,o,a,i){return e.apply(this,arguments)}})()}l.default=u}),226);
__d("getSendReelToInstamadilloRecipient",["fbt","I64","IGDDataclassTypes.flow","LSAuthorityLevel","LSIntEnum","LSMessageReplySourceTypeV2","LSMessageSendStatus","MNXMAPreviewImageDecorationType","asyncToGeneratorRuntime","getErrorSafe","issueSendInstamadilloXMAReceiverFetch","renderInstamadilloOptimisticXmaReceiverFetch"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(t,a,i,l,c){var d,m={__typename:"XMSGIgReceiverFetchXmaClipFetchParams",media_igid:t},p={__typename:"XMSGIgXmaContentRefDataclass",action_type:o("IGDDataclassTypes.flow").XmsgIgXmaActionType.Share,content_type:o("IGDDataclassTypes.flow").XmsgIgReceiverFetchContentType.Clip,fetch_params:m,owner_fbid:a,target_url:l,username:i},_={contentRef:JSON.stringify(p)},f={authorityLevel:(e||(e=o("I64"))).of_int32(r("LSAuthorityLevel").OPTIMISTIC),isForwarded:c,replySourceTypeV2:c===!0?(e||(e=o("I64"))).of_int32(r("LSMessageReplySourceTypeV2").FORWARD):void 0,sendStatus:e.of_int32(r("LSMessageSendStatus").SENDING_TO_SERVER),sendStatusV2:e.of_int32(1)},g={actionUrl:l,nativeUrl:l,targetId:e.of_string(t),type_:"igd_web_post_share"},h={authorityLevel:e.of_int32(r("LSAuthorityLevel").OPTIMISTIC),previewImageDecorationType:(u||(u=o("LSIntEnum"))).ofNumber(r("MNXMAPreviewImageDecorationType").REEL),subtitleText:s._(/*BTDS*/"Reel").toString(),titleText:(d=p.username)!=null?d:""};return(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,o,a,i){try{var l=yield r("renderInstamadilloOptimisticXmaReceiverFetch")(e,_,m,h,g,f);yield r("issueSendInstamadilloXMAReceiverFetch")({comment:o,isDisappearingModeSettingOn:t,offlineThreadingId:l,openEb:n,receiverFetchXma:JSON.stringify(_),threadKey:e}),a==null||a(e)}catch(t){i==null||i(r("getErrorSafe")(t),e)}});return function(t,n,r,o,a,i){return e.apply(this,arguments)}})()}l.default=c}),226);