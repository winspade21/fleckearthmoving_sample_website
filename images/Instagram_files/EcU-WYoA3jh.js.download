;/*FB_PKG_DELIM*/

__d("LSOnMessageStatusChange.nop",["Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r,o,a,i,l,s){return(e||(e=n("Promise"))).resolve()}s.__nop_name__="LSOnMessageStatusChange",l.default=s}),98);
__d("LSReplaceOptimsiticMessage",["LSOnMessageStatusChange.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(r){return t.sequence([function(r){return t.nativeOperation(n("LSOnMessageStatusChange.nop"),void 0,e[0],e[1],t.i64.cast([0,60]),void 0)},function(n){return t.forEach(t.filter(t.db.table(12).fetch([[[e[0]]],"optimistic"]),function(n){return n.offlineThreadingId===e[0]&&t.i64.eq(n.authorityLevel,t.i64.cast([0,20]))}),function(n){var r=n.update,o=n.item;return r({messageId:e[1],authorityLevel:t.i64.cast([0,60]),sendStatus:t.i64.cast([0,2]),sendStatusV2:t.i64.cast([0,2])})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxReplaceOptimsiticMessageStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSUpdateMessagesOptimisticContext",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(31).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.taskId,e[0])&&n.textHasLinks!==void 0}),function(e){var t=e.update,n=e.item;return t({textHasLinks:void 0})})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateMessagesOptimisticContextStoredProcedure",e.__tables__=["messages_optimistic_context"],a.exports=e}),null);
__d("LSWriteCTAIdToThreadsTable",["LSGetFirstAvailableAttachmentCTAID"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return e[1]===void 0?t.forEach(t.filter(t.db.table(9).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&(t.i64.neq(n.lastMessageCtaId,void 0)||n.lastMessageCtaType!==void 0)}),function(t){var n=t.update,r=t.item;return n({lastMessageCtaId:void 0,lastMessageCtaType:void 0,lastMessageCtaTimestampMs:e[2]})}):t.i64.neq(e[2],void 0)?t.sequence([function(n){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[0]=t.i64.cast([0,0]):(n=a.item,r[0]=n.lastActivityTimestampMs)})},function(o){return t.i64.ge(e[2],r[0])?t.sequence([function(e){return t.storedProcedure(n("LSGetFirstAvailableAttachmentCTAID")).then(function(e){var t;return t=e,r[2]=t[0],t})},function(n){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({lastMessageCtaId:r[2],lastMessageCtaType:e[1],lastMessageCtaTimestampMs:e[2]})})}]):t.resolve(0)}]):t.resolve()},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxWriteCTAIdToThreadsTableStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);